import{u as e,b as t,j as a}from"./index-DJm1U2HJ.js";import{r as s}from"./react-vendor-D-XgqoRR.js";import{K as l,r,P as d,C as i}from"./ui-vendor-D0H4cakl.js";import"./socket-vendor-CUkmNz_4.js";function n({orderNumber:n}){const{isAuthenticated:o}=e(),[c,x]=s.useState(n||""),[m,u]=s.useState(""),[h,b]=s.useState("full"),[p,g]=s.useState([]),[j,f]=s.useState(null),[v,k]=s.useState(!1),[N,y]=s.useState(!1),[w,C]=s.useState(""),[S,O]=s.useState(!1);s.useEffect(()=>{if(!c){const e=window.location.hash.match(/cancel-order\/(.+)/);e&&e[1]&&x(decodeURIComponent(e[1]))}},[c]),s.useEffect(()=>{c&&o&&q()},[c,o]);const q=async()=>{try{k(!0);const e=await t.orders.getById(c);f(e),"delivered"!==e.status&&"completed"!==e.status&&C("Only delivered orders can be cancelled");const a=e.delivered_at||e.updated_at;if(a){const e=new Date(a),t=new Date;Math.floor((t.getTime()-e.getTime())/864e5)>5&&C("Cancellation can only be requested within 5 days of delivery")}}catch(e){C(e.message||"Failed to fetch order details")}finally{k(!1)}};return S?a.jsx("main",{className:"py-10 dark:bg-slate-900 min-h-screen",children:a.jsx("div",{className:"mx-auto max-w-2xl px-4",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg p-8 text-center",children:[a.jsx(l,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),a.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"Cancellation Request Submitted"}),a.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Your cancellation request has been submitted successfully. Our team will review it and process your refund within 5-7 business days."}),a.jsx("button",{onClick:()=>window.location.hash=`#/user/order/${c}`,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Back to Order Details"})]})})}):a.jsx("main",{className:"py-10 dark:bg-slate-900 min-h-screen",children:a.jsxs("div",{className:"mx-auto max-w-2xl px-4",children:[a.jsxs("button",{onClick:()=>window.location.hash=`#/user/order/${c||""}`,className:"flex items-center gap-2 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 mb-6",children:[a.jsx(r,{className:"w-4 h-4"}),"Back to Order Details"]}),a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"w-12 h-12 bg-orange-100 dark:bg-orange-900/20 rounded-full flex items-center justify-center",children:a.jsx(d,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Cancel Order"}),a.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Order #",c||"Loading..."]})]})]}),w&&a.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start gap-3",children:[a.jsx(i,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),a.jsx("div",{children:a.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:w})})]}),v?a.jsx("div",{className:"text-center py-12",children:a.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Loading order details..."})}):j?a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),m.trim())if("partial"!==h||0!==p.length)try{y(!0),C("");const e="partial"===h&&(null==j?void 0:j.items)?p.map(e=>j.items[e]):void 0;await t.cancellations.requestCancellation({order_number:c,reason:m.trim(),cancellation_type:h,items_to_cancel:e}),O(!0),setTimeout(()=>{window.location.hash=`#/user/order/${c}`},2e3)}catch(a){C(a.message||"Failed to submit cancellation request")}finally{y(!1)}else C("Please select at least one item to cancel");else C("Please provide a reason for cancellation")},className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"What would you like to cancel?"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center gap-3 p-4 border border-slate-300 dark:border-slate-600 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[a.jsx("input",{type:"radio",name:"cancellation_type",value:"full",checked:"full"===h,onChange:()=>{b("full"),g([])},className:"w-4 h-4 text-blue-600"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:"Full Order"}),a.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Cancel all items in this order"})]})]}),a.jsxs("label",{className:"flex items-center gap-3 p-4 border border-slate-300 dark:border-slate-600 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[a.jsx("input",{type:"radio",name:"cancellation_type",value:"partial",checked:"partial"===h,onChange:()=>b("partial"),className:"w-4 h-4 text-blue-600"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:"Partial Order"}),a.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Cancel specific items"})]})]})]})]}),"partial"===h&&j.items&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Select items to cancel:"}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:j.items.map((e,t)=>a.jsxs("label",{className:"flex items-center gap-3 p-3 border border-slate-300 dark:border-slate-600 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[a.jsx("input",{type:"checkbox",checked:p.includes(t),onChange:()=>{return e=t,void("full"!==h&&g(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]));var e},className:"w-4 h-4 text-blue-600 rounded"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:e.name||e.title||"Product"}),a.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Quantity: ",e.quantity||1," × ₹",parseFloat(e.price||0).toLocaleString("en-IN")]})]})]},t))})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:["Reason for cancellation ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:m,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-700 dark:text-slate-100 mb-3",required:!0,children:[a.jsx("option",{value:"",children:"Select a reason"}),["Changed my mind","Product not as described","Damaged product","Wrong product received","Delivery delay","Better price available","No longer needed","Other"].map(e=>a.jsx("option",{value:e,children:e},e))]}),"Other"===m&&a.jsx("textarea",{value:m,onChange:e=>u(e.target.value),placeholder:"Please provide more details...",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-700 dark:text-slate-100",rows:3,required:!0})]}),a.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[a.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"Refund Information"}),a.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[a.jsx("li",{children:"• Refund will be processed within 5-7 business days"}),a.jsx("li",{children:"• Refund will be credited to your original payment method"}),a.jsx("li",{children:"• You will receive an email confirmation once the refund is processed"})]})]}),a.jsxs("div",{className:"flex items-center gap-4 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>window.location.hash=`#/user/order/${c}`,className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:N||!m.trim(),className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:N?"Submitting...":"Submit Cancellation Request"})]})]}):a.jsx("div",{className:"text-center py-12",children:a.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Order not found"})})]})]})})}export{n as default};
