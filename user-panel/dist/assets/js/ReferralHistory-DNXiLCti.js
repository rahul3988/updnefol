import{g as e,j as t}from"./index-ClLTTH7Q.js";import{r as s}from"./react-vendor-D-XgqoRR.js";import{s as a,D as r,a0 as l,T as d,at as n,P as i,O as o,au as x}from"./ui-vendor-30WxTOTI.js";import"./socket-vendor-CUkmNz_4.js";function c(){const[c,m]=s.useState([]),[p,u]=s.useState(null),[h,g]=s.useState(!0),[f,j]=s.useState("all"),[v,k]=s.useState("date");s.useEffect(()=>{N()},[]);const N=async()=>{var t,s,a,r,l;try{const d=localStorage.getItem("token");if(!d)return m([]),void u(null);const n=e(),i=await fetch(`${n}/api/affiliate/referrals`,{headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});if(i.ok){const e=await i.json();m(e.referrals||[]);const d=(null==(t=e.referrals)?void 0:t.length)||0,n=(null==(s=e.referrals)?void 0:s.filter(e=>"active"===e.status).length)||0,o=(null==(a=e.referrals)?void 0:a.reduce((e,t)=>e+(t.commission_earned||0),0))||0,x=(null==(r=e.referrals)?void 0:r.reduce((e,t)=>e+(t.total_orders||0),0))||0,c=(null==(l=e.referrals)?void 0:l.reduce((e,t)=>e+(t.total_spent||0),0))||0;u({total_referrals:d,active_referrals:n,total_commission:o,total_orders:x,total_spent:c,average_order_value:x>0?c/x:0,conversion_rate:d>0?n/d*100:0})}else m([]),u(null)}catch(d){m([]),u(null)}finally{g(!1)}},b=[...c.filter(e=>"all"===f||e.status===f)].sort((e,t)=>{switch(v){case"date":return new Date(t.signup_date).getTime()-new Date(e.signup_date).getTime();case"commission":return t.commission_earned-e.commission_earned;case"orders":return t.total_orders-e.total_orders;default:return 0}});return h?t.jsx("main",{className:"py-10 dark:bg-slate-900 min-h-screen flex items-center justify-center"}):t.jsx("main",{className:"py-10 dark:bg-slate-900 min-h-screen",children:t.jsxs("div",{className:"mx-auto max-w-6xl px-4",children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("button",{onClick:()=>window.location.hash="#/user/affiliate-partner",className:"flex items-center gap-2 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 transition-colors mb-4",children:[t.jsx(a,{className:"h-4 w-4"}),"Back to Affiliate Dashboard"]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"Referral History"}),t.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Track and analyze your referral performance"})]}),t.jsxs("button",{onClick:()=>{const e=[["Name","Email","Signup Date","Orders","Total Spent","Commission","Status","Conversion Rate"].join(","),...b.map(e=>[e.name,e.email,e.signup_date,e.total_orders,e.total_spent,e.commission_earned,e.status,e.conversion_rate].join(","))].join("\n"),t=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`referral-history-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s)},className:"flex items-center gap-2 px-4 py-2 text-white rounded-lg transition-colors",style:{backgroundColor:"rgb(75,151,201)"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="rgb(60,120,160)",onMouseLeave:e=>e.currentTarget.style.backgroundColor="rgb(75,151,201)",children:[t.jsx(r,{className:"h-4 w-4"}),"Export CSV"]})]})]}),p&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8",children:[t.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 font-medium",children:"Total Referrals"}),t.jsx("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:p.total_referrals})]}),t.jsx(l,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})]})}),t.jsx("div",{className:"bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 font-medium",children:"Active Referrals"}),t.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:p.active_referrals})]}),t.jsx(d,{className:"h-8 w-8 text-green-600 dark:text-green-400"})]})}),t.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400 font-medium",children:"Total Commission"}),t.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:["₹",p.total_commission.toFixed(2)]})]}),t.jsx(n,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"})]})}),t.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-lg p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400 font-medium",children:"Avg Order Value"}),t.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:["₹",p.average_order_value.toFixed(0)]})]}),t.jsx(i,{className:"h-8 w-8 text-orange-600 dark:text-orange-400"})]})}),t.jsx("div",{className:"bg-gradient-to-r from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-lg p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 font-medium",children:"Conversion Rate"}),t.jsxs("p",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:[p.conversion_rate.toFixed(1),"%"]})]}),t.jsx(o,{className:"h-8 w-8 text-red-600 dark:text-red-400"})]})})]}),t.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(x,{className:"h-4 w-4 text-slate-500"}),t.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Filter:"}),t.jsxs("select",{value:f,onChange:e=>j(e.target.value),className:"px-3 py-1 border border-slate-300 dark:border-slate-600 rounded-lg text-sm dark:bg-slate-700 dark:text-slate-100",children:[t.jsx("option",{value:"all",children:"All Referrals"}),t.jsx("option",{value:"active",children:"Active Only"}),t.jsx("option",{value:"inactive",children:"Inactive Only"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Sort by:"}),t.jsxs("select",{value:v,onChange:e=>k(e.target.value),className:"px-3 py-1 border border-slate-300 dark:border-slate-600 rounded-lg text-sm dark:bg-slate-700 dark:text-slate-100",children:[t.jsx("option",{value:"date",children:"Signup Date"}),t.jsx("option",{value:"commission",children:"Commission"}),t.jsx("option",{value:"orders",children:"Order Count"})]})]})]}),t.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Showing ",b.length," of ",c.length," referrals"]})]})}),t.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Referral"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Signup Date"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Orders"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Total Spent"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Commission"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Conversion"})]})}),t.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:b.map(e=>t.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:e.name}),t.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:e.email})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100",children:new Date(e.signup_date).toLocaleDateString()}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100",children:e.total_orders}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100",children:["₹",e.total_spent.toFixed(2)]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100",children:["₹",e.commission_earned.toFixed(2)]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("active"===e.status?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400"),children:e.status})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100",children:[e.conversion_rate,"%"]})]},e.id))})]})})}),0===b.length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(l,{className:"h-16 w-16 text-slate-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold dark:text-slate-100 mb-2",children:"No Referrals Found"}),t.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No referrals match your current filter criteria"})]})]})})}export{c as default};
