import{b as e,g as t,j as s}from"./index-NAoTB2tM.js";import{r as a}from"./react-vendor-D-XgqoRR.js";import{Q as r,O as d,av as l,y as i,i as n,l as c,a7 as x,P as o,c as m}from"./ui-vendor-30WxTOTI.js";import"./socket-vendor-CUkmNz_4.js";function h(){var h,u,p,g,b,k;const[j,N]=a.useState(null),[v,f]=a.useState(!0),[y,w]=a.useState(null),[_,P]=a.useState(null),[S,C]=a.useState(!1),[I,D]=a.useState(null),U=new URL(window.location.href),O=new URLSearchParams(U.hash.split("?")[1]||"").get("order");a.useEffect(()=>{O?T(O):f(!1)},[O]),a.useEffect(()=>{(null==j?void 0:j.id)&&$()},[null==j?void 0:j.id]),a.useEffect(()=>{if((null==I?void 0:I.awb_code)&&(null==j?void 0:j.id)){L();const e=setInterval(()=>{L()},3e4);return()=>clearInterval(e)}},[null==I?void 0:I.awb_code,null==j?void 0:j.id]);const T=async t=>{try{const s=await e.orders.getById(t);N(s)}catch(s){w(s.message||"Failed to fetch order details. Please ensure you are logged in.")}finally{f(!1)}},$=async()=>{if(null==j?void 0:j.id)try{const e=t(),s=localStorage.getItem("token"),a={"Content-Type":"application/json"};s&&(a.Authorization=`Bearer ${s}`);const r=await fetch(`${e}/api/shiprocket_shipments?order_id=${j.id}`,{headers:a});if(r.ok){const e=await r.json(),t=Array.isArray(e)?e:e.data||[];if(t.length>0){const e=t.find(e=>e.order_id===j.id)||t[0];D(e),e.awb_code&&(null==j?void 0:j.id)&&L()}}}catch(e){}},L=async e=>{if(null==j?void 0:j.id)try{C(!0);const e=t(),s=localStorage.getItem("token"),a={"Content-Type":"application/json"};s&&(a.Authorization=`Bearer ${s}`);const r=await fetch(`${e}/api/shiprocket/orders/${j.id}/track`,{headers:a});if(r.ok){const e=await r.json();P(e)}}catch(s){}finally{C(!1)}};return v?s.jsx("main",{className:"py-10 dark:bg-slate-900",children:s.jsx("div",{className:"mx-auto max-w-3xl px-4 text-center",children:s.jsx("p",{className:"mt-2 text-slate-600 dark:text-slate-400",children:"Loading order details..."})})}):y||!j?s.jsx("main",{className:"py-10 dark:bg-slate-900",children:s.jsxs("div",{className:"mx-auto max-w-3xl px-4 text-center",children:[s.jsx("h1",{className:"text-3xl font-bold mb-2 dark:text-slate-100",children:"Order Not Found"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:y||"Unable to load order details"}),s.jsx("a",{href:"#/user/shop",className:"inline-block mt-6 rounded px-5 py-2.5 font-semibold text-white",style:{backgroundColor:"rgb(75,151,201)"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="rgb(60,120,160)",onMouseLeave:e=>e.currentTarget.style.backgroundColor="rgb(75,151,201)",children:"Continue Shopping"})]})}):s.jsx("main",{className:"min-h-screen bg-gray-50 dark:bg-slate-900 py-6",children:s.jsxs("div",{className:"mx-auto max-w-6xl px-4 sm:px-6 lg:px-8",children:[s.jsx("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg p-6 mb-4",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:s.jsx(r,{className:"h-10 w-10 text-green-600 dark:text-green-500"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h1",{className:"text-2xl font-normal dark:text-slate-100 mb-1",children:["Thank you, ",j.customer_name.split(" ")[0],"!"]}),s.jsx("p",{className:"text-base text-slate-600 dark:text-slate-400 mb-4",children:"Your order has been confirmed"}),s.jsx("div",{className:"bg-gray-50 dark:bg-slate-900/50 border border-gray-300 dark:border-slate-600 rounded p-4 mb-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Order number: "}),s.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:j.order_number})]}),j.invoice_number&&s.jsxs("div",{children:[s.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Invoice: "}),s.jsx("span",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:j.invoice_number})]}),j.shipment_id&&s.jsxs("div",{children:[s.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Shipment ID: "}),s.jsx("span",{className:"text-sm font-medium text-purple-600 dark:text-purple-400",children:j.shipment_id})]})]})}),s.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded p-4",children:s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[s.jsx(d,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Estimated delivery date"}),s.jsx("p",{className:"text-base font-medium dark:text-slate-100",children:(null==(u=null==(h=null==_?void 0:_.tracking_data)?void 0:h.edd)?void 0:u.date)?new Date(_.tracking_data.edd.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):j.estimated_delivery||"Will be updated soon"}),(null==(p=null==_?void 0:_.tracking_data)?void 0:p.courier_name)&&s.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:["Courier: ",_.tracking_data.courier_name]}),(null==I?void 0:I.awb_code)&&s.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:["AWB: ",I.awb_code]})]})]}),(null==I?void 0:I.awb_code)&&s.jsx("button",{onClick:()=>L(),disabled:S,className:"flex-shrink-0 p-1.5 rounded hover:bg-blue-100 dark:hover:bg-blue-900/40 transition-colors disabled:opacity-50",title:"Refresh tracking",children:s.jsx(l,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})})]})}),(null==(g=null==_?void 0:_.tracking_data)?void 0:g.shipment_track_activities)&&_.tracking_data.shipment_track_activities.length>0&&s.jsxs("div",{className:"mt-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-sm font-medium dark:text-slate-100 mb-3",children:"Tracking Updates"}),s.jsx("div",{className:"space-y-3",children:_.tracking_data.shipment_track_activities.slice().reverse().map((e,t)=>{var a;return s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx("div",{className:"w-2 h-2 rounded-full mt-1.5 "+(0===t?"bg-green-500":"bg-gray-300 dark:bg-gray-600")}),(null==(a=_.tracking_data)?void 0:a.shipment_track_activities)&&t<_.tracking_data.shipment_track_activities.length-1&&s.jsx("div",{className:"w-0.5 h-6 bg-gray-300 dark:bg-gray-600 ml-0.5"})]}),s.jsxs("div",{className:"flex-1 pb-3 last:pb-0",children:[s.jsx("p",{className:"text-sm font-medium dark:text-slate-100",children:e.status||e.activity||"Update"}),e.location&&s.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-0.5",children:e.location}),e.date&&s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-0.5",children:new Date(e.date).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]},t)})})]}),(null==(k=null==(b=null==_?void 0:_.tracking_data)?void 0:b.shipment_track)?void 0:k[0])&&s.jsx("div",{className:"mt-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded p-3",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(i,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-medium text-green-900 dark:text-green-100",children:"Current Status"}),s.jsx("p",{className:"text-sm font-medium dark:text-slate-100 mt-0.5",children:_.tracking_data.shipment_track[0].current_status||_.tracking_data.shipment_status||"In Transit"}),_.tracking_data.shipment_track[0].current_status_location&&s.jsx("p",{className:"text-xs text-green-700 dark:text-green-300 mt-0.5",children:_.tracking_data.shipment_track[0].current_status_location}),_.tracking_data.shipment_track[0].current_status_time&&s.jsx("p",{className:"text-xs text-green-700 dark:text-green-300 mt-0.5",children:new Date(_.tracking_data.shipment_track[0].current_status_time).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[s.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg p-6",children:[s.jsx("h2",{className:"text-lg font-medium dark:text-slate-100 mb-4 pb-3 border-b border-gray-200 dark:border-slate-700",children:"Order Items"}),s.jsx("div",{className:"space-y-6",children:j.items.map((e,a)=>{var r;const d=e.list_image||e.image||e.product_image,l=d&&d.startsWith("http")?d:d?`${t()}${d.startsWith("/")?"":"/"}${d}`:null;return s.jsxs("div",{className:"flex gap-4 pb-6 border-b border-gray-200 dark:border-slate-700 last:border-0 last:pb-0",children:[l&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx("img",{src:l,alt:e.title||"Product",className:"w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-lg border border-gray-200 dark:border-slate-700",onError:e=>{e.target.style.display="none"}})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-base font-medium dark:text-slate-100 mb-1",children:e.title}),s.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:["Quantity: ",e.quantity]}),(null==(r=e.csvProduct)?void 0:r.SKU)&&s.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500 mb-2",children:["SKU: ",e.csvProduct.SKU]}),e.csvProduct&&s.jsxs("details",{className:"mt-3",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-medium text-slate-700 dark:text-slate-300 hover:text-slate-900 dark:hover:text-slate-100",children:"View Product Details"}),s.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs bg-gray-50 dark:bg-slate-900/50 p-3 rounded",children:[e.csvProduct["Brand Name"]&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-400",children:"Brand: "}),s.jsx("span",{className:"dark:text-slate-100",children:e.csvProduct["Brand Name"]})]}),e.csvProduct["HSN Code"]&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-400",children:"HSN Code: "}),s.jsx("span",{className:"dark:text-slate-100",children:e.csvProduct["HSN Code"]})]}),e.csvProduct["Net Quantity (Content)"]&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-400",children:"Net Quantity: "}),s.jsx("span",{className:"dark:text-slate-100",children:e.csvProduct["Net Quantity (Content)"]})]}),e.csvProduct["Net Weight (Product Only)"]&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-400",children:"Net Weight: "}),s.jsx("span",{className:"dark:text-slate-100",children:e.csvProduct["Net Weight (Product Only)"]})]}),e.csvProduct["Country of Origin"]&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-400",children:"Country of Origin: "}),s.jsx("span",{className:"dark:text-slate-100",children:e.csvProduct["Country of Origin"]})]}),e.csvProduct["GST %"]&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-400",children:"GST: "}),s.jsxs("span",{className:"dark:text-slate-100",children:[e.csvProduct["GST %"],"%"]})]}),e.csvProduct["Manufacturer / Packer / Importer"]&&s.jsxs("div",{className:"sm:col-span-2",children:[s.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-400",children:"Manufacturer: "}),s.jsx("span",{className:"dark:text-slate-100",children:e.csvProduct["Manufacturer / Packer / Importer"]})]}),e.csvProduct["Key Ingredients"]&&s.jsxs("div",{className:"sm:col-span-2",children:[s.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-400",children:"Key Ingredients: "}),s.jsx("span",{className:"dark:text-slate-100",children:e.csvProduct["Key Ingredients"]})]}),e.csvProduct["Package Content Details"]&&s.jsxs("div",{className:"sm:col-span-2",children:[s.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-400",children:"Package Contents: "}),s.jsx("span",{className:"dark:text-slate-100",children:e.csvProduct["Package Content Details"]})]})]})]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("p",{className:"text-base font-medium dark:text-slate-100",children:["₹",(parseFloat(e.price)*e.quantity).toFixed(2)]})})]},a)})})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg p-6",children:[s.jsx("h2",{className:"text-lg font-medium dark:text-slate-100 mb-4 pb-3 border-b border-gray-200 dark:border-slate-700",children:"Shipping Address"}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(n,{className:"h-5 w-5 text-slate-600 dark:text-slate-400 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[s.jsx("p",{className:"font-medium text-slate-900 dark:text-slate-100 mb-1",children:j.customer_name}),s.jsx("p",{children:j.shipping_address.address}),s.jsxs("p",{children:[j.shipping_address.city,", ",j.shipping_address.state," ",j.shipping_address.zip]}),s.jsxs("p",{className:"mt-1",children:["Phone: ",j.shipping_address.phone]})]})]})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg p-6",children:[s.jsx("h2",{className:"text-lg font-medium dark:text-slate-100 mb-4 pb-3 border-b border-gray-200 dark:border-slate-700",children:"Payment Method"}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(c,{className:"h-5 w-5 text-slate-600 dark:text-slate-400 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Payment Method"}),s.jsx("p",{className:"text-sm font-medium dark:text-slate-100",children:(e=>{switch(null==e?void 0:e.toLowerCase()){case"cod":return"Cash on Delivery";case"razorpay":return"Razorpay Secure (UPI, Cards, Int'l Cards, Wallets)";case"coins":return"Coins Payment";default:return e||"Not specified"}})(j.payment_method)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Payment Type"}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:(e=>{switch(null==e?void 0:e.toLowerCase()){case"cod":return"Cash on Delivery";case"prepaid":return"Prepaid Payment";case"postpaid":return"Postpaid Payment";default:return e||"Not specified"}})(j.payment_type)})]}),s.jsxs("div",{className:"pt-2 mt-2 border-t border-gray-200 dark:border-slate-700",children:[s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Order Date"}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:new Date(j.created_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})]})]})]}),s.jsx("div",{className:"lg:col-span-1",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg p-6 sticky top-4",children:[s.jsx("h2",{className:"text-lg font-medium dark:text-slate-100 mb-4 pb-3 border-b border-gray-200 dark:border-slate-700",children:"Order Summary"}),s.jsxs("div",{className:"space-y-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Items:"}),s.jsxs("span",{className:"dark:text-slate-100",children:["₹",Number(j.subtotal||0).toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Shipping:"}),s.jsxs("span",{className:"dark:text-slate-100",children:["₹",Number(j.shipping||0).toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"GST:"}),s.jsxs("span",{className:"dark:text-slate-100",children:["₹",Number(j.tax||0).toFixed(2)]})]}),s.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-slate-700",children:s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-base font-medium dark:text-slate-100",children:"Order Total:"}),s.jsxs("span",{className:"text-base font-medium dark:text-slate-100",children:["₹",Number(j.total||0).toFixed(2)]})]})})]}),s.jsxs("div",{className:"mt-6 space-y-3",children:[s.jsx("a",{href:"#/user/shop",className:"block w-full text-center rounded-md bg-yellow-400 hover:bg-yellow-500 px-4 py-2 text-sm font-medium text-gray-900 transition-colors",children:"Continue Shopping"}),s.jsxs("button",{onClick:()=>{const e=t();window.open(`${e}/api/invoices/${j.order_number}/download`,"_blank")},className:"w-full rounded-md border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-slate-200 hover:bg-gray-50 dark:hover:bg-slate-600 transition-colors flex items-center justify-center gap-2",children:[s.jsx(x,{className:"h-4 w-4"}),"Print Invoice"]})]}),s.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-slate-700",children:s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[(e=>{switch(e){case"confirmed":return s.jsx(r,{className:"h-5 w-5 text-green-500"});case"shipped":return s.jsx(i,{className:"h-5 w-5 text-blue-500"});case"delivered":return s.jsx(o,{className:"h-5 w-5 text-green-600"});default:return s.jsx(m,{className:"h-5 w-5 text-yellow-500"})}})(j.status),s.jsx("span",{className:"text-sm font-medium dark:text-slate-100",children:(e=>{switch(e){case"confirmed":return"Order Confirmed";case"shipped":return"Shipped";case"delivered":return"Delivered";default:return"Processing"}})(j.status)})]})})]})})]}),s.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[j.invoice_number&&s.jsx("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(r,{className:"h-5 w-5 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-green-900 dark:text-green-100 mb-1",children:"Invoice Generated"}),s.jsx("p",{className:"text-xs text-green-700 dark:text-green-300",children:"Sent to your email"})]})]})}),j.shipment_id&&s.jsx("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(i,{className:"h-5 w-5 text-purple-600 dark:text-purple-400 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-purple-900 dark:text-purple-100 mb-1",children:"Shiprocket Integration"}),s.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-300",children:"Processing for delivery"})]})]})}),s.jsx("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(o,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Delivery Updates"}),s.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"SMS & email notifications enabled"})]})]})})]})]})})}export{h as default};
