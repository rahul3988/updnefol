import{u as e,g as t,j as a}from"./index-CLOjC2NB.js";import{r as s}from"./react-vendor-D-XgqoRR.js";import{s as n,C as r,W as l,B as i,l as o,c,t as m,u as d,v as u}from"./ui-vendor-30WxTOTI.js";import"./socket-vendor-CUkmNz_4.js";function x(){const{user:x}=e(),[h,p]=s.useState(0),[b,g]=s.useState(0),[f,y]=s.useState(!1),[w,j]=s.useState([]),[_,N]=s.useState(!1),[v,k]=s.useState({amount:"",withdrawal_method:"upi",account_holder_name:"",account_number:"",ifsc_code:"",bank_name:"",upi_id:""}),[S,F]=s.useState({});s.useEffect(()=>{C(),I();const e=setInterval(()=>{I(),C()},3e4);return()=>{clearInterval(e)}},[]);const C=async()=>{try{const a=localStorage.getItem("token");if(!a)return;const s=await fetch(`${t()}/api/nefol-coins`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});let n=0,r=0;if(s.ok){const e=await s.json();n=e.nefol_coins||0,r=void 0!==e.available_coins?e.available_coins:n}g(r);let l=0;try{const e=await fetch(`${t()}/api/affiliate/dashboard`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(e.ok){const t=await e.json();t.total_earnings&&(l=Math.floor(10*t.total_earnings))}}catch(e){}p(n+l)}catch(e){}},I=async()=>{try{const e=localStorage.getItem("token");if(!e)return;const a=await fetch(`${t()}/api/coin-withdrawals`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(a.ok){const e=await a.json();j(e.data||[])}}catch(e){}},$=e=>{const{name:t,value:a}=e.target;k(e=>({...e,[t]:a})),S[t]&&F(e=>({...e,[t]:""}))},T=e=>{switch(e){case"completed":return a.jsx(u,{className:"w-5 h-5 text-green-600"});case"rejected":case"failed":return a.jsx(d,{className:"w-5 h-5 text-red-600"});case"processing":return a.jsx(m,{className:"w-5 h-5 text-blue-600"});default:return a.jsx(c,{className:"w-5 h-5 text-yellow-600"})}},q=e=>{const t={pending:"bg-yellow-100 text-yellow-800 border-yellow-300",processing:"bg-blue-100 text-blue-800 border-blue-300",completed:"bg-green-100 text-green-800 border-green-300",rejected:"bg-red-100 text-red-800 border-red-300",failed:"bg-red-100 text-red-800 border-red-300"};return a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${t[e]||t.pending}`,children:e.charAt(0).toUpperCase()+e.slice(1)})};return a.jsxs("main",{className:"min-h-screen bg-white overflow-x-hidden py-8 sm:py-12 md:py-16",style:{fontFamily:"var(--font-body-family, Inter, sans-serif)"},children:[a.jsx("style",{children:"\n        :root {\n          --arctic-blue-primary: #7DD3D3;\n          --arctic-blue-primary-hover: #5EC4C4;\n          --arctic-blue-primary-dark: #4A9FAF;\n          --arctic-blue-light: #E0F5F5;\n          --arctic-blue-lighter: #F0F9F9;\n          --arctic-blue-background: #F4F9F9;\n        }\n      "}),a.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"mb-8 sm:mb-12",children:[a.jsxs("button",{onClick:()=>window.location.hash="#/user/nefol-coins",className:"flex items-center gap-2 mb-6 text-sm font-light tracking-wide transition-opacity hover:opacity-70",style:{color:"#666",letterSpacing:"0.05em"},children:[a.jsx(n,{className:"w-4 h-4"}),"back to coins"]}),a.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-light tracking-[0.15em] mb-6",style:{color:"#1a1a1a",fontFamily:"var(--font-heading-family)",letterSpacing:"0.15em"},children:"coin withdrawal"}),a.jsx("p",{className:"text-sm sm:text-base font-light tracking-wide",style:{color:"#666",letterSpacing:"0.05em"},children:"Withdraw your nefol coins to bank or UPI"})]}),a.jsx("div",{className:"bg-white rounded-2xl border border-slate-100 p-6 sm:p-8 mb-8 shadow-sm",children:a.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start sm:justify-between gap-6",children:[a.jsxs("div",{className:"text-center sm:text-left",children:[a.jsx("p",{className:"text-xs sm:text-sm font-light mb-3 tracking-wide",style:{color:"#666",letterSpacing:"0.05em"},children:"available coins"}),a.jsxs("div",{className:"flex items-baseline gap-2 justify-center sm:justify-start",style:{fontVariantNumeric:"tabular-nums",lineHeight:"1"},children:[a.jsx("p",{className:"text-lg sm:text-xl font-bold",style:{color:"rgb(26, 26, 26)"},children:b.toLocaleString()}),a.jsx("span",{className:"text-lg sm:text-xl font-bold",style:{color:"rgb(26, 26, 26)"},children:"coins"})]}),a.jsxs("p",{className:"text-xs mt-2 font-light tracking-wide",style:{color:"#999",letterSpacing:"0.02em"},children:["(₹",(b/10).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),")"]})]}),a.jsx("button",{onClick:()=>N(!_),className:"px-6 sm:px-8 py-3 text-xs sm:text-sm font-light transition-all duration-300 tracking-[0.15em] uppercase rounded-xl",style:{backgroundColor:_?"#999":"var(--arctic-blue-primary)",color:"#fff",letterSpacing:"0.15em"},onMouseEnter:e=>{_||(e.currentTarget.style.backgroundColor="var(--arctic-blue-primary-hover)")},onMouseLeave:e=>{_||(e.currentTarget.style.backgroundColor="var(--arctic-blue-primary)")},children:_?"cancel":"request withdrawal"})]})}),_&&a.jsxs("div",{className:"bg-white rounded-2xl border border-slate-100 p-6 sm:p-8 mb-8 shadow-sm",children:[a.jsx("h2",{className:"text-2xl sm:text-3xl font-light mb-6 tracking-[0.15em]",style:{color:"#1a1a1a",fontFamily:"var(--font-heading-family)",letterSpacing:"0.15em"},children:"request withdrawal"}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return!v.amount||parseFloat(v.amount)<=0?e.amount="Please enter a valid amount":parseFloat(v.amount)<10?e.amount="Minimum withdrawal is 10 coins":parseFloat(v.amount)>b&&(e.amount=`Insufficient coins. You have ${b} withdrawable coins available. (Affiliate earnings are added to your balance when processed)`),v.account_holder_name||(e.account_holder_name="Account holder name is required"),"bank"===v.withdrawal_method?(v.account_number||(e.account_number="Account number is required"),v.ifsc_code||(e.ifsc_code="IFSC code is required"),v.bank_name||(e.bank_name="Bank name is required")):v.upi_id||(e.upi_id="UPI ID is required"),F(e),0===Object.keys(e).length})()){y(!0);try{const e=localStorage.getItem("token");if(!e)return void alert("Please login to continue");const a={amount:parseFloat(v.amount),withdrawal_method:v.withdrawal_method,account_holder_name:v.account_holder_name};"bank"===v.withdrawal_method?(a.account_number=v.account_number,a.ifsc_code=v.ifsc_code,a.bank_name=v.bank_name):a.upi_id=v.upi_id;const s=await fetch(`${t()}/api/coin-withdrawals`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await s.json();if(s.ok){alert("Withdrawal request submitted successfully!"),N(!1),k({amount:"",withdrawal_method:"upi",account_holder_name:"",account_number:"",ifsc_code:"",bank_name:"",upi_id:""}),await C(),await I();const e=new CustomEvent("coinsUpdated");window.dispatchEvent(e)}else alert(n.message||"Failed to submit withdrawal request")}catch(a){alert("Failed to submit withdrawal request. Please try again.")}finally{y(!1)}}},className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-light mb-2 tracking-wide",style:{color:"#666",letterSpacing:"0.05em"},children:"amount (coins)"}),a.jsx("input",{type:"number",name:"amount",value:v.amount,onChange:$,min:"1",max:b,className:`w-full px-4 py-3 rounded-lg border ${S.amount?"border-red-500":"border-slate-200"} bg-white text-slate-900 focus:outline-none focus:ring-1 focus:ring-slate-900 transition-all`,style:{fontFamily:"var(--font-body-family, Inter, sans-serif)",letterSpacing:"0.02em"},placeholder:"Enter amount to withdraw"}),S.amount&&a.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[a.jsx(r,{className:"w-4 h-4"}),S.amount]}),a.jsxs("p",{className:"mt-2 text-xs font-light tracking-wide",style:{color:"#999",letterSpacing:"0.02em"},children:["Minimum withdrawal: 10 coins (₹1)",a.jsx("br",{}),a.jsx("span",{children:"1 rupee = 10 coins"}),b<h&&a.jsxs(a.Fragment,{children:[a.jsx("br",{}),a.jsxs("span",{className:"text-amber-600",children:["Note: Affiliate earnings (",h-b," coins) will be added to your balance when processed"]})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-light mb-2 tracking-wide",style:{color:"#666",letterSpacing:"0.05em"},children:"withdrawal method"}),a.jsxs("select",{name:"withdrawal_method",value:v.withdrawal_method,onChange:$,className:"w-full px-4 py-3 rounded-lg border border-slate-200 bg-white text-slate-900 focus:outline-none focus:ring-1 focus:ring-slate-900 transition-all",style:{fontFamily:"var(--font-body-family, Inter, sans-serif)",letterSpacing:"0.02em"},children:[a.jsx("option",{value:"upi",children:"UPI Transfer"}),a.jsx("option",{value:"bank",children:"Bank Transfer"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-light mb-2 tracking-wide",style:{color:"#666",letterSpacing:"0.05em"},children:"account holder name"}),a.jsx("input",{type:"text",name:"account_holder_name",value:v.account_holder_name,onChange:$,className:`w-full px-4 py-3 rounded-lg border ${S.account_holder_name?"border-red-500":"border-slate-200"} bg-white text-slate-900 focus:outline-none focus:ring-1 focus:ring-slate-900 transition-all`,style:{fontFamily:"var(--font-body-family, Inter, sans-serif)",letterSpacing:"0.02em"},placeholder:"Enter account holder name"}),S.account_holder_name&&a.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[a.jsx(r,{className:"w-4 h-4"}),S.account_holder_name]})]}),"upi"===v.withdrawal_method&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-light mb-2 tracking-wide",style:{color:"#666",letterSpacing:"0.05em"},children:"upi id"}),a.jsx("input",{type:"text",name:"upi_id",value:v.upi_id,onChange:$,className:`w-full px-4 py-3 rounded-lg border ${S.upi_id?"border-red-500":"border-slate-200"} bg-white text-slate-900 focus:outline-none focus:ring-1 focus:ring-slate-900 transition-all`,style:{fontFamily:"var(--font-body-family, Inter, sans-serif)",letterSpacing:"0.02em"},placeholder:"yourname@upi"}),S.upi_id&&a.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[a.jsx(r,{className:"w-4 h-4"}),S.upi_id]})]}),"bank"===v.withdrawal_method&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-light mb-2 tracking-wide",style:{color:"#666",letterSpacing:"0.05em"},children:"account number"}),a.jsx("input",{type:"text",name:"account_number",value:v.account_number,onChange:$,className:`w-full px-4 py-3 rounded-lg border ${S.account_number?"border-red-500":"border-slate-200"} bg-white text-slate-900 focus:outline-none focus:ring-1 focus:ring-slate-900 transition-all`,style:{fontFamily:"var(--font-body-family, Inter, sans-serif)",letterSpacing:"0.02em"},placeholder:"Enter account number"}),S.account_number&&a.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[a.jsx(r,{className:"w-4 h-4"}),S.account_number]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-light mb-2 tracking-wide",style:{color:"#666",letterSpacing:"0.05em"},children:"ifsc code"}),a.jsx("input",{type:"text",name:"ifsc_code",value:v.ifsc_code,onChange:$,className:`w-full px-4 py-3 rounded-lg border ${S.ifsc_code?"border-red-500":"border-slate-200"} bg-white text-slate-900 focus:outline-none focus:ring-1 focus:ring-slate-900 transition-all`,style:{fontFamily:"var(--font-body-family, Inter, sans-serif)",letterSpacing:"0.02em"},placeholder:"Enter IFSC code"}),S.ifsc_code&&a.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[a.jsx(r,{className:"w-4 h-4"}),S.ifsc_code]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-light mb-2 tracking-wide",style:{color:"#666",letterSpacing:"0.05em"},children:"bank name"}),a.jsx("input",{type:"text",name:"bank_name",value:v.bank_name,onChange:$,className:`w-full px-4 py-3 rounded-lg border ${S.bank_name?"border-red-500":"border-slate-200"} bg-white text-slate-900 focus:outline-none focus:ring-1 focus:ring-slate-900 transition-all`,style:{fontFamily:"var(--font-body-family, Inter, sans-serif)",letterSpacing:"0.02em"},placeholder:"Enter bank name"}),S.bank_name&&a.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[a.jsx(r,{className:"w-4 h-4"}),S.bank_name]})]})]})]}),a.jsx("button",{type:"submit",disabled:f,className:"w-full px-6 py-3 text-xs sm:text-sm font-light transition-all duration-300 tracking-[0.15em] uppercase rounded-xl disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:f?"#999":"var(--arctic-blue-primary)",color:"#fff",letterSpacing:"0.15em"},onMouseEnter:e=>{f||(e.currentTarget.style.backgroundColor="var(--arctic-blue-primary-hover)")},onMouseLeave:e=>{f||(e.currentTarget.style.backgroundColor="var(--arctic-blue-primary)")},children:f?"submitting...":"submit request"})]})]}),a.jsxs("div",{className:"bg-white rounded-2xl border border-slate-100 p-6 sm:p-8 shadow-sm",children:[a.jsx("h2",{className:"text-2xl sm:text-3xl font-light mb-6 tracking-[0.15em]",style:{color:"#1a1a1a",fontFamily:"var(--font-heading-family)",letterSpacing:"0.15em"},children:"payout history"}),0===w.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(l,{className:"w-12 h-12 mx-auto mb-4",style:{color:"#999"}}),a.jsx("p",{className:"text-sm font-light tracking-wide",style:{color:"#666",letterSpacing:"0.02em"},children:"No withdrawal requests yet"})]}):a.jsx("div",{className:"space-y-4",children:w.map(e=>{return a.jsxs("div",{className:"border-b border-slate-100 pb-4 last:border-b-0 last:pb-0 hover:opacity-70 transition-opacity",children:[a.jsx("div",{className:"flex items-start justify-between mb-3",children:a.jsxs("div",{className:"flex items-start gap-4 flex-1",children:["bank"===e.withdrawal_method?a.jsx(i,{className:"w-5 h-5 text-blue-600 mt-1"}):a.jsx(o,{className:"w-5 h-5 text-purple-600 mt-1"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[a.jsxs("p",{className:"text-base sm:text-lg font-light",style:{color:"#1a1a1a",fontVariantNumeric:"tabular-nums",lineHeight:"1",letterSpacing:"0.02em"},children:[e.amount," coins"]}),a.jsxs("p",{className:"text-lg sm:text-xl font-bold",style:{color:"rgb(26, 26, 26)",fontVariantNumeric:"tabular-nums",lineHeight:"1"},children:["(₹",(e.amount/10).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),")"]})]}),a.jsx("p",{className:"text-xs font-light tracking-wide mb-2",style:{color:"#999",letterSpacing:"0.02em"},children:(t=e.created_at,new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}),a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[T(e.status),q(e.status)]})]})]})}),a.jsxs("div",{className:"text-sm font-light tracking-wide space-y-1 ml-9",style:{color:"#666",letterSpacing:"0.02em"},children:[a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"Method:"})," ","bank"===e.withdrawal_method?"Bank Transfer":"UPI Transfer"]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"Account:"})," ",e.account_holder_name]}),"bank"===e.withdrawal_method&&a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"Bank:"})," ",e.bank_name]}),"upi"===e.withdrawal_method&&e.upi_id&&a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"UPI:"})," ",e.upi_id]}),e.transaction_id&&a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"Transaction ID:"})," ",e.transaction_id]}),e.rejection_reason&&a.jsxs("p",{className:"text-red-600",children:[a.jsx("span",{className:"font-medium",children:"Reason:"})," ",e.rejection_reason]})]})]},e.id);var t})})]})]})]})}export{x as default};
