import{d as e,u as t,b as a,i as s,j as r,p as l,n as d}from"./index-BdN9D1iE.js";import{r as i}from"./react-vendor-D-XgqoRR.js";import{P as n}from"./PricingDisplay-U_etTNzB.js";import{A as o}from"./AuthGuard-DYsSFoeq.js";import{P as c}from"./PhoneInput-EDFkUqxd.js";import{i as m,q as x}from"./ui-vendor-BjTBABCK.js";import"./socket-vendor-CUkmNz_4.js";function u({affiliateId:u}){var p,h;const b=e(),g=(null==b?void 0:b.items)||[],j=(null==b?void 0:b.subtotal)||0,f=(null==b?void 0:b.tax)||0;null==b||b.total;const y=null==b?void 0:b.clear,{user:N,isAuthenticated:v}=t(),[k,w]=i.useState(null),[P,C]=i.useState(!1),[S,_]=i.useState(null),[M,I]=i.useState("cod"),[F,q]=i.useState("prepaid"),[z,U]=i.useState([]),[$,R]=i.useState(0),[A,D]=i.useState(0),[O,L]=i.useState(0),[T,E]=i.useState(!1),[B,H]=i.useState(""),[G,W]=i.useState(null),[K,V]=i.useState({}),[Y,Q]=i.useState(""),[J,X]=i.useState(""),[Z,ee]=i.useState(""),[te,ae]=i.useState(""),[se,re]=i.useState(""),[le,de]=i.useState("+91"),[ie,ne]=i.useState(""),[oe,ce]=i.useState(""),[me,xe]=i.useState(""),[ue,pe]=i.useState("Uttar Pradesh"),[he,be]=i.useState(""),[ge,je]=i.useState("India"),[fe,ye]=i.useState(!1),[Ne,ve]=i.useState(!1),[ke,we]=i.useState(!0),[Pe,Ce]=i.useState(""),[Se,_e]=i.useState(""),[Me,Ie]=i.useState(""),[Fe,qe]=i.useState(""),[ze,Ue]=i.useState(""),[$e,Re]=i.useState(""),[Ae,De]=i.useState("Uttar Pradesh"),[Oe,Le]=i.useState(""),[Te,Ee]=i.useState("India"),[Be,He]=i.useState(""),[Ge,We]=i.useState("+91"),[Ke,Ve]=i.useState([]),[Ye,Qe]=i.useState("");i.useEffect(()=>{var e,t,a,s;const r=new URL(window.location.href).hash.split("?")[1]||"",l=new URLSearchParams(r).get("buy");if(w(l),v&&N){const r=(N.name||"").split(" ");Q(r[0]||""),X(r.slice(1).join(" ")||""),ae(N.email||""),re(N.phone||""),ne((null==(e=N.address)?void 0:e.street)||""),xe((null==(t=N.address)?void 0:t.city)||""),pe((null==(a=N.address)?void 0:a.state)||"Uttar Pradesh"),be((null==(s=N.address)?void 0:s.zip)||""),je("India"),R(N.loyalty_points||0)}at(),et(),v&&(Ze(),Je())},[v,N]);const Je=async()=>{try{const e=await a.user.getAddresses();if(e&&e.length>0){Ve(e);const t=e.find(e=>e.is_default);t&&(Qe(String(t.id)),Xe(t))}}catch(e){}},Xe=e=>{const t=(e.name||"").split(" ");Q(t[0]||""),X(t.slice(1).join(" ")||""),re(e.phone||""),ne(e.street||""),ce(e.area||""),xe(e.city||""),pe(e.state||"Uttar Pradesh"),be(e.zip||""),je(e.country||"India")},Ze=async()=>{try{const t=localStorage.getItem("token");if(!t)return;const a="http://192.168.1.36:2000",s=await fetch(`${a}/api/nefol-coins`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});let r=0;if(s.ok){r=(await s.json()).nefol_coins||0}let l=0;try{const e=await fetch(`${a}/api/affiliate/dashboard`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(e.ok){const t=await e.json();t.total_earnings&&(l=Math.floor(10*t.total_earnings))}}catch(e){}D(r+l)}catch(e){}},et=async()=>{try{const e="http://192.168.1.36:2000",t=await fetch(`${e}/api/products-csv`);if(t.ok){const e=await t.json(),a={};e.forEach(e=>{var t;const s={};Object.keys(e).forEach(t=>{const a=t.trim();s[a]=e[t]});const r=s.Slug||(null==(t=s["Product Name"])?void 0:t.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""))||"";r&&(a[r]=s)}),V(a)}}catch(e){}},tt=i.useMemo(()=>(k?g.filter(e=>e.slug===k):g).map(e=>{const t=K[e.slug];return{...e,csvProduct:t||null}}),[k,g,K]),at=async()=>{try{const e="http://192.168.1.36:2000",t=await fetch(`${e}/api/payment-gateways`);if(t.ok){const e=await t.json();U(e.filter(e=>e.is_active))}}catch(e){}},st=i.useMemo(()=>k?tt.reduce((e,t)=>e+s(t.price)*(t.quantity||1),0):j,[k,tt,j]),rt=()=>{if(!G)return 0;if(void 0!==G.discountAmount)return G.discountAmount;if("percentage"===G.type){let e=st*G.value/100;return G.maxDiscount&&e>G.maxDiscount&&(e=G.maxDiscount),e}return G.value},lt=(()=>{if(k){const e=tt[0];if(!e)return 0;const t=s(e.price);return(t-t/(1+((e.category||"").toLowerCase().includes("hair")?.05:.18)))*(e.quantity||1)}return f})(),dt=rt(),it=tt.reduce((e,t)=>{var a,r,l;let d=null;if(t.mrp)d=t.mrp;else if(null==(a=t.details)?void 0:a.mrp)d=t.details.mrp;else if(null==(l=null==(r=t.product)?void 0:r.details)?void 0:l.mrp)d=t.product.details.mrp;else if(t.csvProduct){const e=t.csvProduct;d=e["MRP (₹)"]||e["MRP "]||e.MRP||e.mrp||e["MRP(₹)"]||e["MRP(₹) "]}d||(d=t.price);const i=s(d||"0");return e+i*(t.quantity||1)},0),nt=tt.reduce((e,t)=>{var a,r,l;let d=null;if(t.mrp)d=t.mrp;else if(null==(a=t.details)?void 0:a.mrp)d=t.details.mrp;else if(null==(l=null==(r=t.product)?void 0:r.details)?void 0:l.mrp)d=t.product.details.mrp;else if(t.csvProduct){const e=t.csvProduct;d=e["MRP (₹)"]||e["MRP "]||e.MRP||e.mrp||e["MRP(₹)"]||e["MRP(₹) "]}d||(d=t.price);const i=(s(d||"0")-s(t.price))*(t.quantity||1);return e+Math.max(0,i)},0),ot=T?Math.min(O/10,st-dt):0,ct=st-dt-ot,mt=k?Math.max(0,ct+0):Math.max(0,j-dt-ot+0),xt=mt<1e3,ut="cod"===M;i.useEffect(()=>{xt||q("prepaid")},[xt]);const pt=()=>tt.map(e=>{const t=K[e.slug]||{};return{...e,csvProduct:{"Brand Name":t["Brand Name"],SKU:t.SKU,"HSN Code":t["HSN Code"],"Net Quantity (Content)":t["Net Quantity (Content)"],"Unit Count (Pack of)":t["Unit Count (Pack of)"],"Net Weight (Product Only)":t["Net Weight (Product Only)"],"Dead Weight (Packaging Only)":t["Dead Weight (Packaging Only)"],"GST %":t["GST %"],"Country of Origin":t["Country of Origin"],"Manufacturer / Packer / Importer":t["Manufacturer / Packer / Importer"],"Key Ingredients":t["Key Ingredients"],"Ingredient Benefits":t["Ingredient Benefits"],"How to Use (Steps)":t["How to Use (Steps)"],"Package Content Details":t["Package Content Details"],"Inner Packaging Type":t["Inner Packaging Type"],"Outer Packaging Type":t["Outer Packaging Type"],"Hazardous / Fragile (Y/N)":t["Hazardous / Fragile (Y/N)"],"Special Attributes (Badges)":t["Special Attributes (Badges)"],"Product Category":t["Product Category"],"Product Sub-Category":t["Product Sub-Category"],"Product Type":t["Product Type"],"Skin/Hair Type":t["Skin/Hair Type"],MRP:t.MRP,"website price":t["website price"],discount:t.discount,"Image Links":t["Image Links"],"Video Links":t["Video Links"]}}}),ht=(e,t)=>{const a=e.replace(/\D/g,"");return a.length>10?a.slice(-10):10===a.length?a:a.padStart(10,"0").slice(-10)};return tt.length?r.jsx(o,{children:r.jsx("main",{className:"py-10 dark:bg-slate-900 w-full overflow-x-hidden",children:r.jsxs("div",{className:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 w-full",children:[r.jsxs("form",{onSubmit:async e=>{e.preventDefault(),_(null);const t=(()=>{if(!(null==Y?void 0:Y.trim()))return"First name is required";if(!(null==J?void 0:J.trim()))return"Last name is required";if(!(null==ie?void 0:ie.trim()))return"Address is required";if(!(null==me?void 0:me.trim()))return"City is required";if(!(null==ue?void 0:ue.trim()))return"State is required";if(!(null==he?void 0:he.trim()))return"PIN code is required";if(!(null==se?void 0:se.trim()))return"Phone number is required";if(!(null==te?void 0:te.trim()))return"Email is required";if(10!==se.replace(/\D/g,"").length)return"Please enter a valid 10-digit phone number";if(!ke){if(!(null==Be?void 0:Be.trim()))return"Billing phone number is required";if(10!==Be.replace(/\D/g,"").length)return"Please enter a valid 10-digit billing phone number"}const e=/^\d{6}$/,t=he.replace(/\D/g,"");if(6!==t.length||!e.test(t))return"Please enter a valid 6-digit PIN code";if(!ke&&Oe){const t=Oe.replace(/\D/g,"");if(6!==t.length||!e.test(t))return"Please enter a valid 6-digit billing PIN code"}return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(te)?null:"Please enter a valid email address"})();if(t)_(t);else if(T&&O/10<ct&&!M)_("Please select a payment method for the remaining amount");else{C(!0);try{if("razorpay"===M)return void(await(async()=>{try{const e=`NEFOL-${Date.now()}`,t=pt(),s=rt(),r={order_number:e,customer_name:`${Y} ${J}`.trim(),customer_email:te,shipping_address:{firstName:Y.trim(),lastName:J.trim(),company:Z.trim()||void 0,address:ie.trim(),apartment:oe.trim()||void 0,city:me.trim(),state:ue.trim(),zip:he.trim(),pincode:he.trim(),phone:ht(se,le),country:ge||"India",email:te.trim()},billing_address:ke?{firstName:Y.trim(),lastName:J.trim(),company:Z.trim()||void 0,address:ie.trim(),apartment:oe.trim()||void 0,city:me.trim(),state:ue.trim(),zip:he.trim(),country:ge||"India",phone:ht(se,le),email:te.trim()}:{firstName:Pe.trim(),lastName:Se.trim(),company:Me.trim()||void 0,address:Fe.trim(),apartment:ze.trim()||void 0,city:$e.trim(),state:Ae.trim(),zip:Oe.trim(),pincode:Oe.trim(),country:Te||"India",phone:ht(Be||se,Ge||le),email:te.trim()},items:t,subtotal:Number(st.toFixed(2)),shipping:0,tax:lt,total:Number(mt.toFixed(2)),payment_method:T&&O>0?"coins+razorpay":"razorpay",payment_type:F,status:"created",affiliate_id:u,discount_code:(null==G?void 0:G.code)||null,discount_amount:s>0?Number(s.toFixed(2)):0,coins_used:T?O:0};await a.orders.createOrder(r);const i=await a.payment.createRazorpayOrder({amount:mt,currency:"INR",order_number:e,customer_name:`${Y} ${J}`.trim(),customer_email:te,customer_phone:`${le}${ht(se,le)}`}),n={key:i.key_id,amount:i.amount,currency:i.currency,name:"Nefol",description:`Order ${e}`,order_id:i.id,prefill:{name:`${Y} ${J}`.trim(),email:te,contact:`${le}${ht(se,le)}`},handler:async function(s){try{await a.payment.verifyRazorpayPayment({razorpay_order_id:s.razorpay_order_id,razorpay_payment_id:s.razorpay_payment_id,razorpay_signature:s.razorpay_signature,order_number:e}),l.purchase(d({...r,order_number:e,items:t})),y&&y(),window.location.hash=`#/user/confirmation?order=${encodeURIComponent(e)}`}catch(i){_("Payment verification failed: "+i.message)}},modal:{ondismiss:async function(){C(!1);try{await a.orders.updatePaymentCancelled(e)}catch(t){}}}};window.Razorpay(n).open()}catch(e){_((null==e?void 0:e.message)||"Payment initiation failed"),C(!1)}})());const e=`NEFOL-${Date.now()}`,t=pt(),s=rt(),r={order_number:e,customer_name:`${Y} ${J}`.trim(),customer_email:te,shipping_address:{firstName:Y.trim(),lastName:J.trim(),company:Z.trim()||void 0,address:ie.trim(),apartment:oe.trim()||void 0,city:me.trim(),state:ue.trim(),zip:he.trim(),pincode:he.trim(),phone:ht(se,le),country:ge||"India",email:te.trim()},billing_address:ke?{firstName:Y.trim(),lastName:J.trim(),company:Z.trim()||void 0,address:ie.trim(),apartment:oe.trim()||void 0,city:me.trim(),state:ue.trim(),zip:he.trim(),country:ge||"India",phone:ht(se,le),email:te.trim()}:{firstName:Pe.trim(),lastName:Se.trim(),company:Me.trim()||void 0,address:Fe.trim(),apartment:ze.trim()||void 0,city:$e.trim(),state:Ae.trim(),zip:Oe.trim(),pincode:Oe.trim(),country:Te||"India",phone:ht(Be||se,Ge||le),email:te.trim()},items:t,subtotal:Number(st.toFixed(2)),shipping:0,tax:lt,total:Number(mt.toFixed(2)),payment_method:T&&O/10>=ct?"coins":M,payment_type:ut?"cod":T&&O/10>=ct?"prepaid":F,status:"created",affiliate_id:u,discount_code:(null==G?void 0:G.code)||null,discount_amount:s>0?Number(s.toFixed(2)):0,coins_used:T?O:0},i=await a.orders.createOrder(r);l.purchase(d({...r,order_number:i.order_number||e,items:t})),y&&y(),window.location.hash=`#/user/confirmation?order=${encodeURIComponent(i.order_number||e)}`}catch(s){_((null==s?void 0:s.message)||"Order failed")}finally{C(!1)}}},className:"md:col-span-2 space-y-6",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold dark:text-slate-100 mb-4",children:"Delivery"}),r.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:["Fields marked with ",r.jsx("span",{className:"text-red-500",children:"*"})," are required for shipping. Please ensure all information is accurate."]}),v&&r.jsxs("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(m,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),r.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Use Saved Address"})]}),Ke.length>0?r.jsxs(r.Fragment,{children:[r.jsxs("select",{value:Ye,onChange:e=>(e=>{Qe(e);const t=Ke.find(t=>String(t.id)===e);t&&Xe(t)})(e.target.value),className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-700 dark:text-slate-100 mb-2 font-medium",children:[r.jsx("option",{value:"",children:"Select a saved address..."}),Ke.map(e=>r.jsxs("option",{value:String(e.id),children:[e.name||"Unnamed"," - ",e.street,", ",e.city,", ",e.state," ",e.zip,e.is_default&&" (Default)"]},e.id))]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Select a saved address to autofill the form below"}),r.jsx("a",{href:"#/user/manage-address",className:"text-xs text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Manage Addresses"})]}),Ye&&r.jsx("button",{type:"button",onClick:()=>{Qe(""),Q(""),X(""),re(""),ne(""),ce(""),xe(""),pe("Uttar Pradesh"),be("")},className:"mt-3 text-sm text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Use new address instead"})]}):r.jsxs("div",{className:"text-center py-3",children:[r.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:"No saved addresses found"}),r.jsx("a",{href:"#/user/manage-address",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Add an address to save time"})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Country"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"IN"}),r.jsx("input",{type:"text",className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",value:ge,readOnly:!0,disabled:!0})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3 w-full",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["First name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"First name",value:Y,onChange:e=>Q(e.target.value),required:!0})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Last name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Last name",value:J,onChange:e=>X(e.target.value),required:!0})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Company (optional)"}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Company",value:Z,onChange:e=>ee(e.target.value)})]}),r.jsxs("div",{className:"mb-3",children:[r.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Address ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Street address",value:ie,onChange:e=>ne(e.target.value),required:!0})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Apartment, suite, etc."}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Apartment, suite, etc.",value:oe,onChange:e=>ce(e.target.value)})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mb-3 w-full",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["City ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"City",value:me,onChange:e=>xe(e.target.value),required:!0})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["State ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-slate-600 dark:text-slate-400 text-sm",children:"UP"}),r.jsx("select",{className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",value:ue,onChange:e=>pe(e.target.value),required:!0,children:r.jsx("option",{value:"Uttar Pradesh",children:"Uttar Pradesh"})})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["PIN code ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"6-digit PIN code",value:he,onChange:e=>be(e.target.value.replace(/\D/g,"").slice(0,6)),required:!0,pattern:"\\d{6}",minLength:6,maxLength:6}),r.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Required for shipping"})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Email ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"email",className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"your@email.com",value:te,onChange:e=>ae(e.target.value),required:!0})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx(c,{value:se,onChange:e=>{const t=e.replace(/\D/g,"").slice(0,10);re(t)},onCountryCodeChange:de,defaultCountry:le,placeholder:"Enter 10-digit phone number",required:!0,showLabel:!0,label:"Phone",className:"mb-3"}),r.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Enter exactly 10 digits (required for shipping)"})]}),r.jsxs("div",{className:"space-y-2 mb-3",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",className:"mr-2 rounded border-slate-300",checked:fe,onChange:e=>ye(e.target.checked)}),r.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Save this information for next time"})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",className:"mr-2 rounded border-slate-300",checked:Ne,onChange:e=>ve(e.target.checked)}),r.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Text me with news and offers"})]})]})]}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Shipping method"}),r.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Enter your shipping address to view available shipping methods."})]}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Coupon Code"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600",placeholder:"Enter coupon code",value:B,onChange:e=>H(e.target.value.toUpperCase()),disabled:!!G}),G?r.jsx("button",{type:"button",onClick:()=>{W(null),H(""),_(null)},className:"rounded bg-red-600 px-4 py-2 font-semibold text-white hover:bg-red-700 transition-colors",children:"Remove"}):r.jsx("button",{type:"button",onClick:async()=>{try{const e="http://192.168.1.36:2000",t=await fetch(`${e}/api/discounts/apply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:B,amount:st})});if(t.ok){const e=await t.json(),a=e.data||e;W(a),_(null)}else{const e=await t.json().catch(()=>({message:"Invalid discount code"}));_(e.message||"Invalid discount code"),W(null)}}catch(e){_("Failed to apply discount code")}},className:"rounded bg-green-600 px-4 py-2 font-semibold text-white hover:bg-green-700 disabled:opacity-50 transition-colors",disabled:!B.trim(),children:"Apply"})]}),G&&r.jsx("div",{className:"mt-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3",children:r.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["✅ Coupon applied: ",G.code," - Save ₹",dt.toFixed(2)]})})]}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Payment"}),r.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"All transactions are secure and encrypted."}),r.jsxs("div",{className:"space-y-3 mb-4",children:[v&&A>0&&r.jsx("div",{className:"p-4 rounded-lg border-2 border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-900/20 mb-4",children:r.jsxs("label",{className:"flex items-start cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:T,onChange:e=>{if(E(e.target.checked),e.target.checked){const e=Math.min(A,Math.ceil(10*ct));L(e),e/10<ct&&I("razorpay")}else L(0),I("cod")},className:"mt-1 mr-3"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(x,{className:"w-5 h-5 text-yellow-600"}),r.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:"Use Nefol Coins"})]}),r.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:["Available: ",A," coins (1 rupee = 10 coins)"]}),T&&r.jsxs("div",{className:"mt-3 space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:["Coins to Use (Max: ",Math.min(A,Math.ceil(10*ct))," coins)"]}),r.jsx("input",{type:"number",min:"0",max:Math.min(A,Math.ceil(10*ct)),value:O,onChange:e=>{const t=parseInt(e.target.value)||0,a=Math.min(A,Math.ceil(10*ct));L(Math.max(0,Math.min(t,a))),t/10<ct&&"coins"===M&&I("razorpay")},className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),r.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[r.jsxs("p",{children:["Coins value: ₹",(O/10).toFixed(2)]}),r.jsxs("p",{className:"font-semibold",children:["Remaining to pay: ₹",Math.max(0,ct-O/10).toFixed(2)]}),O/10>=ct&&r.jsx("p",{className:"text-green-600 dark:text-green-400 font-semibold",children:"✓ Order fully paid with coins! No additional payment needed."})]})]})]})]})}),T&&O/10<ct&&r.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:r.jsxs("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-200 mb-3",children:["Select Payment Method for Remaining Amount: ₹",Math.max(0,ct-O/10).toFixed(2)]})}),(!T||O/10<ct)&&r.jsxs("label",{className:"flex items-start p-4 rounded-lg border-2 cursor-pointer transition-all "+("razorpay"===M?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-300 dark:border-slate-600 hover:border-slate-400"),children:[r.jsx("input",{type:"radio",name:"paymentMethod",value:"razorpay",checked:"razorpay"===M,onChange:e=>I(e.target.value),disabled:T&&O/10>=ct,className:"mt-1 mr-3"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:["Razorpay Secure (UPI, Cards, Int'l Cards, Wallets)",T&&O/10<ct&&r.jsxs("span",{className:"text-xs text-slate-500 ml-2",children:["(Pay ₹",Math.max(0,ct-O/10).toFixed(2),")"]})]}),r.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1 flex items-center gap-1",children:T&&O/10<ct?r.jsxs("span",{children:["Pay remaining ₹",Math.max(0,ct-O/10).toFixed(2)," via Razorpay"]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"UPI"}),r.jsx("span",{children:"•"}),r.jsx("span",{children:"Visa"}),r.jsx("span",{children:"•"}),r.jsx("span",{children:"Mastercard"}),r.jsx("span",{children:"•"}),r.jsx("span",{children:"Net Banking"}),r.jsx("span",{className:"ml-1",children:"+18"})]})})]})]}),(!T||O/10<ct)&&r.jsxs("label",{className:"flex items-start p-4 rounded-lg border-2 cursor-pointer transition-all "+("cod"===M?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-300 dark:border-slate-600 hover:border-slate-400"),children:[r.jsx("input",{type:"radio",name:"paymentMethod",value:"cod",checked:"cod"===M,onChange:e=>I(e.target.value),disabled:T&&O/10>=ct,className:"mt-1 mr-3"}),r.jsx("div",{className:"flex-1",children:r.jsxs("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:["Cash on Delivery (COD)",T&&O/10<ct&&r.jsxs("span",{className:"text-xs text-slate-500 ml-2",children:["(Pay ₹",Math.max(0,mt).toFixed(2)," on delivery)"]})]})})]})]})]}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Billing address"}),r.jsxs("label",{className:"flex items-center mb-4",children:[r.jsx("input",{type:"radio",name:"billingAddress",checked:ke,onChange:()=>we(!0),className:"mr-2"}),r.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Same as shipping address"})]}),r.jsxs("label",{className:"flex items-center mb-4",children:[r.jsx("input",{type:"radio",name:"billingAddress",checked:!ke,onChange:()=>we(!1),className:"mr-2"}),r.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Use a different billing address"})]}),!ke&&r.jsxs("div",{className:"mt-4 space-y-4 pl-4 sm:pl-6 border-l-2 border-slate-300 dark:border-slate-600 w-full",children:[r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"First name"}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"First name",value:Pe,onChange:e=>Ce(e.target.value),required:!ke})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Last name"}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Last name",value:Se,onChange:e=>_e(e.target.value),required:!ke})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Company (optional)"}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Company",value:Me,onChange:e=>Ie(e.target.value)})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Address"}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Address",value:Fe,onChange:e=>qe(e.target.value),required:!ke})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Apartment, suite, etc."}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Apartment, suite, etc.",value:ze,onChange:e=>Ue(e.target.value)})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 w-full",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"City"}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"City",value:$e,onChange:e=>Re(e.target.value),required:!ke})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"State"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-slate-600 dark:text-slate-400 text-sm",children:"UP"}),r.jsx("select",{className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",value:Ae,onChange:e=>De(e.target.value),required:!ke,children:r.jsx("option",{value:"Uttar Pradesh",children:"Uttar Pradesh"})})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["PIN code ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"6-digit PIN code",value:Oe,onChange:e=>Le(e.target.value.replace(/\D/g,"").slice(0,6)),required:!ke,pattern:"\\d{6}",minLength:6,maxLength:6}),r.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Required for shipping"})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx(c,{value:Be,onChange:e=>{const t=e.replace(/\D/g,"").slice(0,10);He(t)},onCountryCodeChange:We,defaultCountry:Ge,placeholder:"Enter 10-digit phone number",required:!ke,showLabel:!0,label:"Billing Phone",className:"mb-3"}),r.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Enter exactly 10 digits (required for shipping)"})]})]})]}),S&&r.jsx("div",{className:"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 p-3 rounded-lg",children:S}),r.jsx("button",{type:"submit",disabled:P,className:"w-full rounded bg-blue-600 px-5 py-3 font-semibold text-white hover:bg-blue-700 disabled:opacity-50 transition-colors",children:P?"Processing Order...":T&&O/10>=ct?`Place Order (Paid with ${O} Coins)`:T&&O/10<ct?`Use ${O} Coins + Pay ₹${mt.toFixed(2)} ${ut?"(COD)":"razorpay"===M?"Now":""}`:ut?`Place Order (COD) - ₹${mt.toFixed(2)}`:"Pay now"})]}),r.jsxs("aside",{className:"w-full md:w-auto",children:[r.jsx("h2",{className:"text-xl font-semibold mb-3 dark:text-slate-100",children:"Order Summary"}),r.jsxs("div",{className:"space-y-3",children:[tt.map(e=>r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsxs("div",{children:[r.jsxs("span",{className:"dark:text-slate-300",children:[e.title," × ",e.quantity]}),r.jsx("div",{className:"text-xs",children:r.jsx(n,{product:e,csvProduct:e.csvProduct,className:"text-xs"})})]}),r.jsxs("span",{className:"dark:text-slate-100",children:["₹",(s(e.price)*e.quantity).toFixed(2)]})]},e.slug)),r.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-3 text-sm space-y-2",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"MRP"}),r.jsxs("span",{className:"dark:text-slate-100",children:["₹",it.toFixed(2)]})]}),nt>0&&r.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[r.jsx("span",{children:"Product Discount"}),r.jsxs("span",{children:["-₹",nt.toFixed(2)]})]}),r.jsxs("div",{className:"flex justify-between font-medium",children:[r.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Subtotal"}),r.jsxs("span",{className:"dark:text-slate-100",children:["₹",st.toFixed(2)]})]}),G&&dt>0&&r.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[r.jsxs("span",{children:["Coupon Code (",G.code,")"]}),r.jsxs("span",{children:["-₹",dt.toFixed(2)]})]}),T&&O>0&&r.jsxs("div",{className:"flex justify-between text-yellow-600 dark:text-yellow-400",children:[r.jsxs("span",{children:["Nefol Coins Used (",O," coins = ₹",(O/10).toFixed(2),")"]}),r.jsxs("span",{children:["-₹",ot.toFixed(2)]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Shipping Charges"}),r.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Free"})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsxs("span",{className:"text-slate-600 dark:text-slate-400",children:["GST (",k?(null==(h=null==(p=tt[0])?void 0:p.category)?void 0:h.toLowerCase().includes("hair"))?"5%":"18%":"Mixed",")",r.jsx("span",{className:"text-xs ml-1",children:"(Inclusive)"})]}),r.jsxs("span",{className:"dark:text-slate-100",children:["₹",lt.toFixed(2)]})]}),r.jsx("div",{className:"border-t border-slate-300 dark:border-slate-600 pt-2 mt-2",children:r.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[r.jsx("span",{className:"dark:text-slate-100",children:"Grand Total"}),r.jsxs("span",{className:"dark:text-slate-100",children:["₹",mt.toFixed(2)]})]})}),r.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"* MRP includes GST"})]})]})]})]})})}):r.jsx(o,{children:r.jsx("main",{className:"py-10 dark:bg-slate-900",children:r.jsxs("div",{className:"mx-auto max-w-3xl px-4",children:[r.jsx("h1",{className:"text-2xl font-bold dark:text-slate-100",children:"Checkout"}),r.jsx("p",{className:"mt-2 text-slate-600 dark:text-slate-400",children:"Your cart is empty."})]})})})}export{u as default};
