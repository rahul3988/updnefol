import{r as e}from"./react-vendor-D-XgqoRR.js";import{g as t,j as s}from"./index-BU2rZxJk.js";const a={},n=new Map;function i(s){const[i,o]=e.useState({}),[r,c]=e.useState(!0),l=e.useCallback(async e=>{const s=e.filter(e=>!a[e]);if(0===s.length){const t={};return e.forEach(e=>{a[e]&&(t[e]=a[e])}),o(t),void c(!1)}const i=s.filter(e=>n.has(e)),r=s.filter(e=>!n.has(e));if(r.length>0){c(!0);try{const s=t(),i=await fetch(`${s}/api/product-reviews/stats/batch`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slugs:r})});if(!i.ok)throw new Error("Failed to fetch review stats");const c=await i.json();Object.keys(c).forEach(e=>{a[e]=c[e]}),r.forEach(e=>n.delete(e));const l={};e.forEach(e=>{a[e]?l[e]=a[e]:l[e]={product_id:null,slug:e,average_rating:0,review_count:0,verified_count:0}}),o(l)}catch(u){const t={};e.forEach(e=>{t[e]={product_id:null,slug:e,average_rating:0,review_count:0,verified_count:0}}),o(t)}finally{c(!1)}}else{const t=i.map(e=>n.get(e));await Promise.all(t),setTimeout(()=>l(e),100)}},[]);e.useEffect(()=>{s.length>0?l(s):c(!1)},[s.join(","),l]);const u=e.useCallback(e=>i[e]||{product_id:null,slug:e,average_rating:0,review_count:0,verified_count:0},[i]);return{stats:i,loading:r,getStats:u}}const o=Object.freeze(Object.defineProperty({__proto__:null,invalidateReviewStatsCache:function(e){e?delete a[e]:Object.keys(a).forEach(e=>delete a[e])},useProductReviewStats:i},Symbol.toStringTag,{value:"Module"}));function r({className:e="",size:t="md"}){return s.jsx("span",{className:`inline-flex items-center justify-center ${e}`,title:"Verified Purchase",children:s.jsxs("svg",{className:{sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"}[t],viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#0095F6"}),s.jsx("path",{d:"M8 12L10.5 14.5L16 9",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]})})}export{r as V,o as a,i as u};
