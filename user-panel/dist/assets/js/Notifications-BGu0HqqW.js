import{u as e,g as t,j as s}from"./index-DHQYPLw0.js";import{r as a}from"./react-vendor-D-XgqoRR.js";import{aa as r,O as i,J as n,x as l,t as o,P as c}from"./ui-vendor-upD1L4Zc.js";import"./socket-vendor-CUkmNz_4.js";function d(){const{user:d,isAuthenticated:x}=e(),[m,u]=a.useState([]),[h,f]=a.useState(!0),[p,j]=a.useState(0),[b,g]=a.useState("all"),N=t(),y=()=>{const e=localStorage.getItem("token");return{"Content-Type":"application/json",...e&&{Authorization:`Bearer ${e}`}}},w=async()=>{var e;if(x)try{const t=await fetch(`${N}/api/user/notifications/unread-count`,{headers:y()});if(t.ok){const s=await t.json();j((null==(e=s.data)?void 0:e.count)||s.count||0)}}catch(t){}},v=e=>{if(e.icon)return e.icon;switch(e.notification_type){case"order_placed":return s.jsx(c,{className:"h-5 w-5 text-blue-600"});case"order_cancelled":return s.jsx(o,{className:"h-5 w-5 text-red-600"});case"order_shipped":return s.jsx(l,{className:"h-5 w-5 text-blue-600"});case"order_delivered":return s.jsx(i,{className:"h-5 w-5 text-green-600"});default:return s.jsx(r,{className:"h-5 w-5 text-slate-600"})}},k=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/6e4),r=Math.floor(s/36e5),i=Math.floor(s/864e5);return a<1?"Just now":a<60?`${a} minute${a>1?"s":""} ago`:r<24?`${r} hour${r>1?"s":""} ago`:i<7?`${i} day${i>1?"s":""} ago`:t.toLocaleDateString()};if(a.useEffect(()=>{x&&((async()=>{if(x)try{f(!0);const e=await fetch(`${N}/api/user/notifications?status=${"all"===b?"all":b}`,{headers:y()});if(e.ok){const t=await e.json();u(t.data||t||[])}else u([])}catch(e){u([])}finally{f(!1)}else f(!1)})(),w())},[x,b]),!x)return s.jsx("main",{className:"py-10 min-h-screen",children:s.jsx("div",{className:"mx-auto max-w-4xl px-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Please log in to view notifications"}),s.jsx("p",{className:"text-gray-600",children:"You need to be logged in to see your notifications."})]})})});const $=m.filter(e=>"all"===b||("unread"===b?"unread"===e.status:"read"!==b||"read"===e.status));return s.jsx("main",{className:"py-10 min-h-screen",style:{backgroundColor:"#F4F9F9"},children:s.jsxs("div",{className:"mx-auto max-w-4xl px-4",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Notifications"}),p>0&&s.jsxs("p",{className:"text-sm text-slate-600",children:[p," unread notification",p>1?"s":""]})]}),p>0&&s.jsx("button",{onClick:async()=>{try{(await fetch(`${N}/api/user/notifications/read-all`,{method:"PUT",headers:y()})).ok&&(u(e=>e.map(e=>({...e,status:"read",read_at:(new Date).toISOString()}))),j(0))}catch(e){}},className:"px-4 py-2 text-sm text-white rounded-lg transition-colors",style:{backgroundColor:"rgb(75,151,201)"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="rgb(60,120,160)",onMouseLeave:e=>e.currentTarget.style.backgroundColor="rgb(75,151,201)",children:"Mark all as read"})]}),s.jsx("div",{className:"flex gap-2 border-b border-slate-200",children:["all","unread","read"].map(e=>s.jsxs("button",{onClick:()=>g(e),className:"px-4 py-2 text-sm font-medium border-b-2 transition-colors "+(b===e?"border-blue-600 text-blue-600":"border-transparent text-slate-600 hover:text-slate-900"),children:[e.charAt(0).toUpperCase()+e.slice(1),"unread"===e&&p>0&&s.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs text-white rounded-full",style:{backgroundColor:"rgb(75,151,201)"},children:p})]},e))})]}),h?s.jsx("div",{className:"text-center py-12",children:s.jsx("p",{className:"mt-4 text-slate-600",children:"Loading notifications..."})}):0===$.length?s.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow-sm",children:[s.jsx(r,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No notifications"}),s.jsx("p",{className:"text-slate-600",children:"unread"===b?"You're all caught up! No unread notifications.":"read"===b?"No read notifications yet.":"You don't have any notifications yet."})]}):s.jsx("div",{className:"space-y-3",children:$.map(e=>s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 transition-all "+("unread"===e.status?"border-blue-600 bg-blue-50/30":"border-slate-200"),children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:v(e)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-slate-900 mb-1 "+("unread"===e.status?"font-bold":""),children:e.title}),s.jsx("p",{className:"text-sm text-slate-600 mb-2",children:e.message}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[s.jsx("span",{children:k(e.created_at)}),"high"===e.priority&&s.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 rounded",children:"High Priority"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:["unread"===e.status&&s.jsx("button",{onClick:()=>(async e=>{try{(await fetch(`${N}/api/user/notifications/${e}/read`,{method:"PUT",headers:y()})).ok&&(u(t=>t.map(t=>t.id===e?{...t,status:"read",read_at:(new Date).toISOString()}:t)),w())}catch(t){}})(e.id),className:"p-2 text-slate-400 hover:text-blue-600 transition-colors",title:"Mark as read",children:s.jsx(i,{className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>(async e=>{try{(await fetch(`${N}/api/user/notifications/${e}`,{method:"DELETE",headers:y()})).ok&&(u(t=>t.filter(t=>t.id!==e)),w())}catch(t){}})(e.id),className:"p-2 text-slate-400 hover:text-red-600 transition-colors",title:"Delete",children:s.jsx(n,{className:"w-5 h-5"})})]})]}),e.link&&s.jsx("a",{href:e.link,className:"inline-block mt-3 text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View Details â†’"})]})]})},e.id))})]})})}export{d as default};
