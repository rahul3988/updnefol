import{d as e,c as t,g as s,k as a,j as r}from"./index-Cl7XhzGX.js";import{r as l}from"./react-vendor-D-XgqoRR.js";import{b as i,c as n,T as o,ab as c,ac as d,ad as m,e as u,d as p}from"./ui-vendor-CApkTAVE.js";import"./socket-vendor-CUkmNz_4.js";function x(){const{addItem:x}=e(),{addToWishlist:h,removeFromWishlist:g,isInWishlist:b}=t(),[f,j]=l.useState(""),[v,N]=l.useState([]),[y,w]=l.useState(!1),[_,S]=l.useState(null),[k,C]=l.useState(null),[I,P]=l.useState(""),[A,F]=l.useState({min:"",max:""}),[E,$]=l.useState([]),[R,T]=l.useState(""),[O,W]=l.useState(""),[L,M]=l.useState("relevance"),[J,q]=l.useState("desc"),[U,z]=l.useState(!1),[B,D]=l.useState(!1),[G,H]=l.useState([]),[K,Q]=l.useState([]),[V,X]=l.useState([]),[Y,Z]=l.useState(1),[ee,te]=l.useState(1),[se,ae]=l.useState(0),re=l.useRef(null),le=l.useRef(null);l.useEffect(()=>{const e=window.location.hash||"#/",t=new URLSearchParams(e.split("?")[1]||"").get("q")||"";j(t),ne(t);const s=localStorage.getItem("nefol_recent_searches");if(s)try{X(JSON.parse(s))}catch(a){}},[]),l.useEffect(()=>{oe()},[]);const ie=e=>{var t,s;let a=e.details;if("string"==typeof a)try{a=JSON.parse(a)}catch(o){a={}}const r=Array.isArray(e.pdp_images)?e.pdp_images:[],l=[];for(let c=1;c<=6;c++){const t=`pdp_image_${c}`;e[t]&&l.push({url:e[t]})}const i=[...r,...l].filter(e=>e&&(e.url||"string"==typeof e)).map(e=>"string"==typeof e?{url:e}:e),n=[e.list_image,...i.map(e=>e.url),e.listImage,e.thumbnail,e.primary_image].find(e=>e&&e.trim().length>0)||"";return{id:(null==(s=null==(t=e.id)?void 0:t.toString)?void 0:s.call(t))||e.id,title:e.title,description:e.description,price:e.price,category:e.category,brand:e.brand,key_ingredients:e.key_ingredients,skin_type:e.skin_type,hair_type:e.hair_type,list_image:n,pdp_images:i,relevance_score:e.relevance_score??0,slug:e.slug,details:a}},ne=async(e,t=1)=>{w(!0),S(null);try{const r=new URLSearchParams({page:t.toString(),limit:"20",sortBy:L,sortOrder:J,...I&&{category:I},...A.min&&{minPrice:A.min},...A.max&&{maxPrice:A.max},...E.length>0&&{ingredients:E.join(",")},...R&&{skinType:R},...O&&{hairType:O}});e&&e.trim()&&r.set("q",e.trim());const l=await fetch(`${s()}/api/search?${r}`);if(!l.ok){await l.text();throw new Error(`Search failed: ${l.status}`)}const i=l.headers.get("content-type");if(!i||!i.includes("application/json")){await l.text();throw new Error("Server returned non-JSON response")}const n=await l.json(),o=(n.products||[]).map(ie);N(o),H(n.suggestions),Q(n.popularSearches),Z(n.pagination.page),te(n.pagination.totalPages),ae(n.pagination.total),e&&e.trim()&&a.trackSearch(e.trim(),n.pagination.total||0);const c=e.trim()?`#/search?q=${encodeURIComponent(e)}`:"#/search";if(window.history.replaceState(null,"",c),e.trim()){const t=[e.trim(),...V.filter(t=>t!==e.trim())].slice(0,5);X(t),localStorage.setItem("nefol_recent_searches",JSON.stringify(t))}}catch(r){S("Failed to search products. Please try again.")}finally{w(!1)}},oe=async()=>{try{const e=await fetch(`${s()}/api/search/filters`);if(!e.ok){await e.text();return}const t=e.headers.get("content-type");if(!t||!t.includes("application/json")){await e.text();return}const a=await e.json();C(a)}catch(e){}},ce=()=>{f.trim()&&ne(f.trim())},de=()=>{P(""),F({min:"",max:""}),$([]),T(""),W(""),M("relevance"),q("desc"),f.trim()&&ne(f.trim())},me=e=>{Z(e),f.trim()&&ne(f.trim(),e)},ue=e=>{if(!e)return"";if(e.startsWith("http"))return e;if(e.startsWith("/IMAGES/"))return e;const t=e.startsWith("/")?e:`/${e}`;return`${s()}${t}`},pe=e=>{const t=[e.list_image,...Array.isArray(e.pdp_images)?e.pdp_images.map(e=>null==e?void 0:e.url):[],e.listImage,e.thumbnail,e.primary_image,e.pdp_image_1,e.pdp_image_2,e.pdp_image_3,e.pdp_image_4,e.pdp_image_5,e.pdp_image_6].find(e=>e&&e.trim().length>0)||"";return ue(t)},xe=e=>{j(e),ne(e),D(!1)};return l.useEffect(()=>{const e=e=>{le.current&&!le.current.contains(e.target)&&re.current&&!re.current.contains(e.target)&&D(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 py-8",children:r.jsxs("div",{className:"mx-auto max-w-7xl px-4",children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-4xl font-bold text-gradient-primary mb-4",children:"Advanced Search"}),r.jsx("p",{className:"text-slate-600 text-lg",children:"Find the perfect products with intelligent search and filters"})]}),r.jsx("div",{className:"mb-8 relative",children:r.jsx("form",{onSubmit:e=>{e.preventDefault(),f.trim()&&(ne(f.trim()),D(!1))},className:"relative",children:r.jsxs("div",{className:"flex gap-4",children:[r.jsxs("div",{className:"flex-1 relative",children:[r.jsx(i,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"}),r.jsx("input",{ref:re,type:"text",value:f,onChange:e=>{const t=e.target.value;if(j(t),D(t.length>=2),t.length>=2){const e=setTimeout(()=>{ne(t)},300);return()=>clearTimeout(e)}},onFocus:()=>D(f.length>=2),placeholder:"Search products, ingredients, or categories...",className:"w-full pl-12 pr-4 py-4 rounded-xl border border-slate-300 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 text-lg"}),B&&r.jsxs("div",{ref:le,className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl border border-slate-200 z-50 max-h-96 overflow-y-auto",children:[G.length>0?r.jsx("div",{className:"p-2",children:G.map((e,t)=>r.jsxs("div",{onClick:()=>xe(e.suggestion),className:"flex items-center gap-3 p-3 rounded-lg hover:bg-slate-50 cursor-pointer transition-colors",children:[r.jsx(i,{className:"w-4 h-4 text-blue-500"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-slate-800",children:e.suggestion}),r.jsxs("div",{className:"text-sm text-slate-500",children:[e.count," products"]})]})]},t))}):null,V.length>0&&r.jsxs("div",{className:"border-t border-slate-200 p-2",children:[r.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-slate-500 uppercase tracking-wide",children:[r.jsx(n,{className:"w-3 h-3 inline mr-1"}),"Recent Searches"]}),V.map((e,t)=>r.jsxs("div",{onClick:()=>xe(e),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer transition-colors",children:[r.jsx(n,{className:"w-3 h-3 text-slate-400"}),r.jsx("span",{className:"text-sm text-slate-600",children:e})]},t))]}),r.jsxs("div",{className:"border-t border-slate-200 p-2",children:[r.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-slate-500 uppercase tracking-wide",children:[r.jsx(o,{className:"w-3 h-3 inline mr-1"}),"Popular Searches"]}),r.jsx("div",{className:"flex flex-wrap gap-2 p-3",children:K.map((e,t)=>r.jsx("button",{onClick:()=>xe(e),className:"px-3 py-1 text-xs bg-slate-100 text-slate-600 rounded-full hover:bg-slate-200 transition-colors",children:e},t))})]})]})]}),r.jsxs("button",{type:"button",onClick:()=>z(!U),className:"px-6 py-4 rounded-xl bg-slate-200 hover:bg-slate-300 transition-colors flex items-center gap-2",children:[r.jsx(c,{className:"w-5 h-5"}),"Filters"]})]})})}),U&&k&&r.jsxs("div",{className:"mb-8 p-6 bg-white rounded-xl shadow-lg border border-slate-200",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"Advanced Filters"}),r.jsx("button",{onClick:de,className:"text-blue-600 hover:text-blue-700 font-medium",children:"Clear All"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Category"}),r.jsxs("select",{value:I,onChange:e=>{P(e.target.value),ce()},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200",children:[r.jsx("option",{value:"",children:"All Categories"}),k.categories.map(e=>r.jsxs("option",{value:e.name,children:[e.name," (",e.count,")"]},e.name))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Price Range (â‚¹)"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"number",placeholder:"Min",value:A.min,onChange:e=>{F(t=>({...t,min:e.target.value})),ce()},className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200"}),r.jsx("input",{type:"number",placeholder:"Max",value:A.max,onChange:e=>{F(t=>({...t,max:e.target.value})),ce()},className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Sort By"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("select",{value:L,onChange:e=>{M(e.target.value),ce()},className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200",children:[r.jsx("option",{value:"relevance",children:"Relevance"}),r.jsx("option",{value:"price",children:"Price"}),r.jsx("option",{value:"title",children:"Name"}),r.jsx("option",{value:"category",children:"Category"}),r.jsx("option",{value:"created_at",children:"Newest"})]}),r.jsx("button",{onClick:()=>{q("asc"===J?"desc":"asc"),ce()},className:"px-3 py-2 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"asc"===J?r.jsx(d,{className:"w-4 h-4"}):r.jsx(m,{className:"w-4 h-4"})})]})]})]})]}),r.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[r.jsx("div",{className:"text-slate-600",children:f?r.jsxs("span",{children:["Found ",r.jsx("strong",{children:se})," result",1!==se?"s":"",' for "',r.jsx("strong",{children:f}),'"']}):r.jsxs("span",{children:["Showing ",r.jsx("strong",{children:se})," product",1!==se?"s":""]})}),r.jsxs("div",{className:"text-sm text-slate-500",children:["Page ",Y," of ",ee]})]}),y&&r.jsx("div",{className:"flex items-center justify-center py-20"}),_&&r.jsxs("div",{className:"text-center py-20",children:[r.jsx("div",{className:"text-red-500 text-xl mb-4",children:"âš ï¸"}),r.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Search Error"}),r.jsx("p",{className:"text-slate-600",children:_})]}),!y&&!_&&v.length>0&&r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:v.map(e=>{var t,s;return r.jsxs("div",{className:"group bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden",children:[r.jsxs("div",{className:"relative",children:[r.jsx("img",{src:pe(e)||"",alt:e.title,className:"w-full h-64 object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy",onError:e=>{e.currentTarget.style.display="none"}}),r.jsx("button",{onClick:()=>(e=>{const t=parseInt(e.id);b(t)?g(t):h(t)})(e),className:"absolute top-3 right-3 p-2 rounded-full transition-colors "+(b(parseInt(e.id))?"bg-red-500 text-white":"bg-white/80 text-slate-600 hover:bg-red-500 hover:text-white"),children:r.jsx(u,{className:"w-4 h-4 "+(b(parseInt(e.id))?"fill-current":"")})}),e.category&&r.jsx("div",{className:"absolute top-3 left-3 px-2 py-1 bg-blue-500 text-white text-xs rounded-full",children:e.category})]}),r.jsxs("div",{className:"p-6",children:[r.jsx("h3",{className:"font-semibold text-slate-800 mb-2 line-clamp-2 group-hover:text-blue-600 transition-colors",children:e.title}),r.jsx("p",{className:"text-slate-600 text-sm mb-4 line-clamp-3",children:e.description}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"flex flex-col",children:(null==(t=e.details)?void 0:t.mrp)&&(null==(s=e.details)?void 0:s.websitePrice)?r.jsxs("div",{children:[r.jsxs("div",{className:"text-gray-500 line-through text-sm",children:["â‚¹",e.details.mrp]}),r.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["â‚¹",e.details.websitePrice]}),r.jsxs("div",{className:"text-xs text-green-500",children:[Math.round((parseFloat(e.details.mrp)-parseFloat(e.details.websitePrice))/parseFloat(e.details.mrp)*100),"% OFF"]})]}):r.jsxs("div",{className:"text-2xl font-bold text-gradient-primary",children:["â‚¹",e.price]})}),r.jsxs("button",{onClick:()=>(e=>{const t=pe(e),s=[t,...Array.isArray(e.pdp_images)?e.pdp_images.map(e=>ue(e.url)):[],e.pdp_image_1&&ue(e.pdp_image_1),e.pdp_image_2&&ue(e.pdp_image_2),e.pdp_image_3&&ue(e.pdp_image_3),e.pdp_image_4&&ue(e.pdp_image_4),e.pdp_image_5&&ue(e.pdp_image_5),e.pdp_image_6&&ue(e.pdp_image_6)].filter((e,t,s)=>!!e&&s.indexOf(e)===t);x({id:parseInt(e.id)||void 0,slug:e.slug||e.title.toLowerCase().replace(/\s+/g,"-"),title:e.title,price:e.price,listImage:t,pdpImages:s,category:e.category,description:e.description},1)})(e),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[r.jsx(p,{className:"w-4 h-4"}),"Add to Cart"]})]})]})]},e.id)})}),!y&&!_&&f&&0===v.length&&r.jsxs("div",{className:"text-center py-20",children:[r.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”"}),r.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"No products found"}),r.jsxs("p",{className:"text-slate-600 mb-6",children:['No products match "',f,'". Try different keywords or adjust your filters.']}),r.jsx("button",{onClick:de,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Clear Filters"})]}),!y&&!_&&ee>1&&r.jsxs("div",{className:"mt-12 flex items-center justify-center gap-2",children:[r.jsx("button",{onClick:()=>me(Y-1),disabled:1===Y,className:"px-4 py-2 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),Array.from({length:Math.min(5,ee)},(e,t)=>{const s=t+1;return r.jsx("button",{onClick:()=>me(s),className:"px-4 py-2 border rounded-lg transition-colors "+(Y===s?"bg-blue-600 text-white border-blue-600":"border-slate-300 hover:bg-slate-50"),children:s},s)}),r.jsx("button",{onClick:()=>me(Y+1),disabled:Y===ee,className:"px-4 py-2 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})})}export{x as default};
