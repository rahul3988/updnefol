import{u as e,g as t,j as s}from"./index-D0_0zfag.js";import{r as a}from"./react-vendor-D-XgqoRR.js";import{a as r}from"./session-DZPRxyc_.js";import{P as l}from"./PricingDisplay-DzymmC9r.js";import{u as i,V as o}from"./VerifiedBadge-DFhwBslU.js";import{g as n,a as c,h as d}from"./product_reviews-CPbJ1aXE.js";import{ae as m,af as u}from"./ui-vendor-CK_V9qH3.js";import"./socket-vendor-CUkmNz_4.js";function h({limit:h=8,className:g=""}){const[f,p]=a.useState([]),[v,x]=a.useState(!0),[y,w]=a.useState(0),{isAuthenticated:j}=e(),N=a.useMemo(()=>f.map(e=>e.slug||"").filter(e=>e),[f]),{stats:b}=i(N),k=Math.ceil(f.length/4),S=4*y,_=S+4,$=f.slice(S,_),I=y>0,L=y<k-1;a.useEffect(()=>{C(),w(0),B()},[j]);const B=async()=>{try{const s=JSON.parse(localStorage.getItem("recently_viewed")||"[]");if(0===s.length)return;const a=t();for(const t of s.slice(0,10))try{await fetch(`${a}/api/products/${t}/view`,{method:"POST",credentials:"include",headers:r(),body:JSON.stringify({source:"localStorage_sync"})})}catch(e){}}catch(s){}},M=e=>{if(!e)return"";if(/^https?:\/\//i.test(e))return e;return`${t().replace(/\/$/,"")}${e.startsWith("/")?e:`/${e}`}`},C=async()=>{try{x(!0);const e=t(),s=JSON.parse(localStorage.getItem("recently_viewed")||"[]");if(j){const t=await fetch(`${e}/api/recommendations/recently-viewed?limit=${h}`,{credentials:"include",headers:r()});if(t.ok){const e=await t.json();if(Array.isArray(e)&&e.length>0){const t=e.map(e=>({...e,listImage:M(e.list_image||e.listImage)}));return void p(t)}}}if(s.length>0){const e=t(),a=s.slice(0,h).map(async t=>{try{const s=await fetch(`${e}/api/products/${t}`,{credentials:"include",headers:r()});if(s.ok){const e=await s.json();return{...e,listImage:M(e.list_image||e.listImage)}}}catch(s){}return null}),l=(await Promise.all(a)).filter(Boolean);p(l)}}catch(e){}finally{x(!1)}};return a.useEffect(()=>{const e=e=>{var t;const s=null==(t=e.detail)?void 0:t.productId;s&&((e=>{try{const t=JSON.parse(localStorage.getItem("recently_viewed")||"[]"),s=[String(e),...t.filter(t=>t!==String(e))].slice(0,20);localStorage.setItem("recently_viewed",JSON.stringify(s))}catch(t){}})(s),C())};return window.addEventListener("product-viewed",e),()=>{window.removeEventListener("product-viewed",e)}},[]),v||0===f.length?null:s.jsx("section",{className:`py-8 md:py-12 ${g}`,children:s.jsxs("div",{className:"mx-auto max-w-7xl px-4",children:[s.jsx("h2",{className:"text-2xl md:text-3xl font-serif mb-6",style:{color:"#1B4965"},children:"Recently Viewed"}),s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:()=>{I&&w(e=>e-1)},className:"absolute left-2 top-1/2 -translate-y-1/2 z-30 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all duration-300 "+(I?"opacity-100 hover:scale-110 cursor-pointer":"opacity-0 pointer-events-none"),style:{backgroundColor:"#fff"},"aria-label":"Previous",disabled:!I,children:s.jsx(m,{className:"w-6 h-6",style:{color:"#1B4965"}})}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:$.map(e=>{const t=e.listImage||e.list_image||e.pdp_images&&e.pdp_images[0]||"",a=M(t);return s.jsxs("a",{href:`#/user/product/${e.slug}`,className:"bg-white rounded-lg shadow-sm overflow-hidden group hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:[a?s.jsx("div",{className:"relative overflow-hidden aspect-square bg-gray-100",children:s.jsx("img",{src:a,alt:e.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",onError:e=>{const t=e.target;t.style.display="none";const s=t.parentElement;s&&(s.innerHTML='<div class="w-full h-full bg-gray-200 flex items-center justify-center"><svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg></div>')}})}):s.jsx("div",{className:"relative overflow-hidden aspect-square bg-gray-100 flex items-center justify-center",children:s.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),s.jsxs("div",{className:"p-3",children:[s.jsx("h3",{className:"text-sm font-medium mb-2 line-clamp-2",style:{color:"#1B4965"},children:e.title}),(()=>{const t=e.slug||"",a=b[t],r=(null==a?void 0:a.average_rating)>0?a.average_rating:n(t),l=(null==a?void 0:a.review_count)>0?a.review_count:c(t),i=(null==a?void 0:a.verified_count)>0||d(t);return r>0?s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx("div",{className:"flex text-yellow-400",children:[...Array(5)].map((e,t)=>{const a=t<Math.round(r);return s.jsx("svg",{className:"w-3 h-3 "+(a?"text-yellow-400":"text-gray-300"),fill:a?"currentColor":"none",stroke:a?"none":"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},t)})}),s.jsxs("span",{className:"text-xs ml-1 font-light",style:{color:"#999"},children:[r.toFixed(1)," (",l,")"]}),i&&s.jsx(o,{size:"sm",className:"ml-1"})]}):null})(),s.jsx(l,{product:e})]})]},e.id||e.slug)})}),s.jsx("button",{onClick:()=>{L&&w(e=>e+1)},className:"absolute right-2 top-1/2 -translate-y-1/2 z-30 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all duration-300 "+(L?"opacity-100 hover:scale-110 cursor-pointer":"opacity-0 pointer-events-none"),style:{backgroundColor:"#fff"},"aria-label":"Next",disabled:!L,children:s.jsx(u,{className:"w-6 h-6",style:{color:"#1B4965"}})})]})]})})}export{h as default};
