import{d as e,u as t,b as a,g as s,i as r,j as l,p as d,n as i}from"./index-C-sV_AkH.js";import{r as n}from"./react-vendor-D-XgqoRR.js";import{P as o}from"./PricingDisplay-qWJH0HH0.js";import{A as c}from"./AuthGuard-7sN8mT2Z.js";import{P as m}from"./PhoneInput-fb9yuYvB.js";import{i as x,q as u}from"./ui-vendor-BjTBABCK.js";import"./socket-vendor-CUkmNz_4.js";function p({affiliateId:p}){var h,b;const g=e(),j=(null==g?void 0:g.items)||[],f=(null==g?void 0:g.subtotal)||0,y=(null==g?void 0:g.tax)||0;null==g||g.total;const N=null==g?void 0:g.clear,{user:v,isAuthenticated:k}=t(),[w,P]=n.useState(null),[C,S]=n.useState(!1),[_,M]=n.useState(null),[I,F]=n.useState("cod"),[q,z]=n.useState("prepaid"),[U,$]=n.useState([]),[R,A]=n.useState(0),[D,O]=n.useState(0),[L,T]=n.useState(0),[E,B]=n.useState(!1),[H,G]=n.useState(""),[W,K]=n.useState(null),[V,Y]=n.useState({}),[Q,J]=n.useState(""),[X,Z]=n.useState(""),[ee,te]=n.useState(""),[ae,se]=n.useState(""),[re,le]=n.useState(""),[de,ie]=n.useState("+91"),[ne,oe]=n.useState(""),[ce,me]=n.useState(""),[xe,ue]=n.useState(""),[pe,he]=n.useState("Uttar Pradesh"),[be,ge]=n.useState(""),[je,fe]=n.useState("India"),[ye,Ne]=n.useState(!1),[ve,ke]=n.useState(!1),[we,Pe]=n.useState(!0),[Ce,Se]=n.useState(""),[_e,Me]=n.useState(""),[Ie,Fe]=n.useState(""),[qe,ze]=n.useState(""),[Ue,$e]=n.useState(""),[Re,Ae]=n.useState(""),[De,Oe]=n.useState("Uttar Pradesh"),[Le,Te]=n.useState(""),[Ee,Be]=n.useState("India"),[He,Ge]=n.useState(""),[We,Ke]=n.useState("+91"),[Ve,Ye]=n.useState([]),[Qe,Je]=n.useState("");n.useEffect(()=>{var e,t,a,s;const r=new URL(window.location.href).hash.split("?")[1]||"",l=new URLSearchParams(r).get("buy");if(P(l),k&&v){const r=(v.name||"").split(" ");J(r[0]||""),Z(r.slice(1).join(" ")||""),se(v.email||""),le(v.phone||""),oe((null==(e=v.address)?void 0:e.street)||""),ue((null==(t=v.address)?void 0:t.city)||""),he((null==(a=v.address)?void 0:a.state)||"Uttar Pradesh"),ge((null==(s=v.address)?void 0:s.zip)||""),fe("India"),A(v.loyalty_points||0)}st(),tt(),k&&(et(),Xe())},[k,v]);const Xe=async()=>{try{const e=await a.user.getAddresses();if(e&&e.length>0){Ye(e);const t=e.find(e=>e.is_default);t&&(Je(String(t.id)),Ze(t))}}catch(e){}},Ze=e=>{const t=(e.name||"").split(" ");J(t[0]||""),Z(t.slice(1).join(" ")||""),le(e.phone||""),oe(e.street||""),me(e.area||""),ue(e.city||""),he(e.state||"Uttar Pradesh"),ge(e.zip||""),fe(e.country||"India")},et=async()=>{try{const t=localStorage.getItem("token");if(!t)return;const a=s(),r=await fetch(`${a}/api/nefol-coins`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});let l=0;if(r.ok){l=(await r.json()).nefol_coins||0}let d=0;try{const e=await fetch(`${a}/api/affiliate/dashboard`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(e.ok){const t=await e.json();t.total_earnings&&(d=Math.floor(10*t.total_earnings))}}catch(e){}O(l+d)}catch(e){}},tt=async()=>{try{const e=s(),t=await fetch(`${e}/api/products-csv`);if(t.ok){const e=await t.json(),a={};e.forEach(e=>{var t;const s={};Object.keys(e).forEach(t=>{const a=t.trim();s[a]=e[t]});const r=s.Slug||(null==(t=s["Product Name"])?void 0:t.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""))||"";r&&(a[r]=s)}),Y(a)}}catch(e){}},at=n.useMemo(()=>(w?j.filter(e=>e.slug===w):j).map(e=>{const t=V[e.slug];return{...e,csvProduct:t||null}}),[w,j,V]),st=async()=>{try{const e=s(),t=await fetch(`${e}/api/payment-gateways`);if(t.ok){const e=await t.json();$(e.filter(e=>e.is_active))}}catch(e){}},rt=n.useMemo(()=>w?at.reduce((e,t)=>e+r(t.price)*(t.quantity||1),0):f,[w,at,f]),lt=()=>{if(!W)return 0;if(void 0!==W.discountAmount)return W.discountAmount;if("percentage"===W.type){let e=rt*W.value/100;return W.maxDiscount&&e>W.maxDiscount&&(e=W.maxDiscount),e}return W.value},dt=(()=>{if(w){const e=at[0];if(!e)return 0;const t=r(e.price);return(t-t/(1+((e.category||"").toLowerCase().includes("hair")?.05:.18)))*(e.quantity||1)}return y})(),it=lt(),nt=at.reduce((e,t)=>{var a,s,l;let d=null;if(t.mrp)d=t.mrp;else if(null==(a=t.details)?void 0:a.mrp)d=t.details.mrp;else if(null==(l=null==(s=t.product)?void 0:s.details)?void 0:l.mrp)d=t.product.details.mrp;else if(t.csvProduct){const e=t.csvProduct;d=e["MRP (₹)"]||e["MRP "]||e.MRP||e.mrp||e["MRP(₹)"]||e["MRP(₹) "]}d||(d=t.price);const i=r(d||"0");return e+i*(t.quantity||1)},0),ot=at.reduce((e,t)=>{var a,s,l;let d=null;if(t.mrp)d=t.mrp;else if(null==(a=t.details)?void 0:a.mrp)d=t.details.mrp;else if(null==(l=null==(s=t.product)?void 0:s.details)?void 0:l.mrp)d=t.product.details.mrp;else if(t.csvProduct){const e=t.csvProduct;d=e["MRP (₹)"]||e["MRP "]||e.MRP||e.mrp||e["MRP(₹)"]||e["MRP(₹) "]}d||(d=t.price);const i=(r(d||"0")-r(t.price))*(t.quantity||1);return e+Math.max(0,i)},0),ct=E?Math.min(L/10,rt-it):0,mt=rt-it-ct,xt=w?Math.max(0,mt+0):Math.max(0,f-it-ct+0),ut=xt<1e3,pt="cod"===I;n.useEffect(()=>{ut||z("prepaid")},[ut]);const ht=()=>at.map(e=>{const t=V[e.slug]||{};return{...e,csvProduct:{"Brand Name":t["Brand Name"],SKU:t.SKU,"HSN Code":t["HSN Code"],"Net Quantity (Content)":t["Net Quantity (Content)"],"Unit Count (Pack of)":t["Unit Count (Pack of)"],"Net Weight (Product Only)":t["Net Weight (Product Only)"],"Dead Weight (Packaging Only)":t["Dead Weight (Packaging Only)"],"GST %":t["GST %"],"Country of Origin":t["Country of Origin"],"Manufacturer / Packer / Importer":t["Manufacturer / Packer / Importer"],"Key Ingredients":t["Key Ingredients"],"Ingredient Benefits":t["Ingredient Benefits"],"How to Use (Steps)":t["How to Use (Steps)"],"Package Content Details":t["Package Content Details"],"Inner Packaging Type":t["Inner Packaging Type"],"Outer Packaging Type":t["Outer Packaging Type"],"Hazardous / Fragile (Y/N)":t["Hazardous / Fragile (Y/N)"],"Special Attributes (Badges)":t["Special Attributes (Badges)"],"Product Category":t["Product Category"],"Product Sub-Category":t["Product Sub-Category"],"Product Type":t["Product Type"],"Skin/Hair Type":t["Skin/Hair Type"],MRP:t.MRP,"website price":t["website price"],discount:t.discount,"Image Links":t["Image Links"],"Video Links":t["Video Links"]}}}),bt=(e,t)=>{const a=e.replace(/\D/g,"");return a.length>10?a.slice(-10):10===a.length?a:a.padStart(10,"0").slice(-10)};return at.length?l.jsx(c,{children:l.jsx("main",{className:"py-10 dark:bg-slate-900 w-full overflow-x-hidden",children:l.jsxs("div",{className:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 w-full",children:[l.jsxs("form",{onSubmit:async e=>{e.preventDefault(),M(null);const t=(()=>{if(!(null==Q?void 0:Q.trim()))return"First name is required";if(!(null==X?void 0:X.trim()))return"Last name is required";if(!(null==ne?void 0:ne.trim()))return"Address is required";if(!(null==xe?void 0:xe.trim()))return"City is required";if(!(null==pe?void 0:pe.trim()))return"State is required";if(!(null==be?void 0:be.trim()))return"PIN code is required";if(!(null==re?void 0:re.trim()))return"Phone number is required";if(!(null==ae?void 0:ae.trim()))return"Email is required";if(10!==re.replace(/\D/g,"").length)return"Please enter a valid 10-digit phone number";if(!we){if(!(null==He?void 0:He.trim()))return"Billing phone number is required";if(10!==He.replace(/\D/g,"").length)return"Please enter a valid 10-digit billing phone number"}const e=/^\d{6}$/,t=be.replace(/\D/g,"");if(6!==t.length||!e.test(t))return"Please enter a valid 6-digit PIN code";if(!we&&Le){const t=Le.replace(/\D/g,"");if(6!==t.length||!e.test(t))return"Please enter a valid 6-digit billing PIN code"}return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ae)?null:"Please enter a valid email address"})();if(t)M(t);else if(E&&L/10<mt&&!I)M("Please select a payment method for the remaining amount");else{S(!0);try{if("razorpay"===I)return void(await(async()=>{try{const e=`NEFOL-${Date.now()}`,t=ht(),s=lt(),r={order_number:e,customer_name:`${Q} ${X}`.trim(),customer_email:ae,shipping_address:{firstName:Q.trim(),lastName:X.trim(),company:ee.trim()||void 0,address:ne.trim(),apartment:ce.trim()||void 0,city:xe.trim(),state:pe.trim(),zip:be.trim(),pincode:be.trim(),phone:bt(re,de),country:je||"India",email:ae.trim()},billing_address:we?{firstName:Q.trim(),lastName:X.trim(),company:ee.trim()||void 0,address:ne.trim(),apartment:ce.trim()||void 0,city:xe.trim(),state:pe.trim(),zip:be.trim(),country:je||"India",phone:bt(re,de),email:ae.trim()}:{firstName:Ce.trim(),lastName:_e.trim(),company:Ie.trim()||void 0,address:qe.trim(),apartment:Ue.trim()||void 0,city:Re.trim(),state:De.trim(),zip:Le.trim(),pincode:Le.trim(),country:Ee||"India",phone:bt(He||re,We||de),email:ae.trim()},items:t,subtotal:Number(rt.toFixed(2)),shipping:0,tax:dt,total:Number(xt.toFixed(2)),payment_method:E&&L>0?"coins+razorpay":"razorpay",payment_type:q,status:"created",affiliate_id:p,discount_code:(null==W?void 0:W.code)||null,discount_amount:s>0?Number(s.toFixed(2)):0,coins_used:E?L:0};await a.orders.createOrder(r);const l=await a.payment.createRazorpayOrder({amount:xt,currency:"INR",order_number:e,customer_name:`${Q} ${X}`.trim(),customer_email:ae,customer_phone:`${de}${bt(re,de)}`}),n={key:l.key_id,amount:l.amount,currency:l.currency,name:"Nefol",description:`Order ${e}`,order_id:l.id,prefill:{name:`${Q} ${X}`.trim(),email:ae,contact:`${de}${bt(re,de)}`},handler:async function(s){try{await a.payment.verifyRazorpayPayment({razorpay_order_id:s.razorpay_order_id,razorpay_payment_id:s.razorpay_payment_id,razorpay_signature:s.razorpay_signature,order_number:e}),d.purchase(i({...r,order_number:e,items:t})),N&&N(),window.location.hash=`#/user/confirmation?order=${encodeURIComponent(e)}`}catch(l){M("Payment verification failed: "+l.message)}},modal:{ondismiss:async function(){S(!1);try{await a.orders.updatePaymentCancelled(e)}catch(t){}}}};window.Razorpay(n).open()}catch(e){M((null==e?void 0:e.message)||"Payment initiation failed"),S(!1)}})());const e=`NEFOL-${Date.now()}`,t=ht(),s=lt(),r={order_number:e,customer_name:`${Q} ${X}`.trim(),customer_email:ae,shipping_address:{firstName:Q.trim(),lastName:X.trim(),company:ee.trim()||void 0,address:ne.trim(),apartment:ce.trim()||void 0,city:xe.trim(),state:pe.trim(),zip:be.trim(),pincode:be.trim(),phone:bt(re,de),country:je||"India",email:ae.trim()},billing_address:we?{firstName:Q.trim(),lastName:X.trim(),company:ee.trim()||void 0,address:ne.trim(),apartment:ce.trim()||void 0,city:xe.trim(),state:pe.trim(),zip:be.trim(),country:je||"India",phone:bt(re,de),email:ae.trim()}:{firstName:Ce.trim(),lastName:_e.trim(),company:Ie.trim()||void 0,address:qe.trim(),apartment:Ue.trim()||void 0,city:Re.trim(),state:De.trim(),zip:Le.trim(),pincode:Le.trim(),country:Ee||"India",phone:bt(He||re,We||de),email:ae.trim()},items:t,subtotal:Number(rt.toFixed(2)),shipping:0,tax:dt,total:Number(xt.toFixed(2)),payment_method:E&&L/10>=mt?"coins":I,payment_type:pt?"cod":E&&L/10>=mt?"prepaid":q,status:"created",affiliate_id:p,discount_code:(null==W?void 0:W.code)||null,discount_amount:s>0?Number(s.toFixed(2)):0,coins_used:E?L:0},l=await a.orders.createOrder(r);d.purchase(i({...r,order_number:l.order_number||e,items:t})),N&&N(),window.location.hash=`#/user/confirmation?order=${encodeURIComponent(l.order_number||e)}`}catch(s){M((null==s?void 0:s.message)||"Order failed")}finally{S(!1)}}},className:"md:col-span-2 space-y-6",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold dark:text-slate-100 mb-4",children:"Delivery"}),l.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:["Fields marked with ",l.jsx("span",{className:"text-red-500",children:"*"})," are required for shipping. Please ensure all information is accurate."]}),k&&l.jsxs("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx(x,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),l.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Use Saved Address"})]}),Ve.length>0?l.jsxs(l.Fragment,{children:[l.jsxs("select",{value:Qe,onChange:e=>(e=>{Je(e);const t=Ve.find(t=>String(t.id)===e);t&&Ze(t)})(e.target.value),className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-700 dark:text-slate-100 mb-2 font-medium",children:[l.jsx("option",{value:"",children:"Select a saved address..."}),Ve.map(e=>l.jsxs("option",{value:String(e.id),children:[e.name||"Unnamed"," - ",e.street,", ",e.city,", ",e.state," ",e.zip,e.is_default&&" (Default)"]},e.id))]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Select a saved address to autofill the form below"}),l.jsx("a",{href:"#/user/manage-address",className:"text-xs text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Manage Addresses"})]}),Qe&&l.jsx("button",{type:"button",onClick:()=>{Je(""),J(""),Z(""),le(""),oe(""),me(""),ue(""),he("Uttar Pradesh"),ge("")},className:"mt-3 text-sm text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Use new address instead"})]}):l.jsxs("div",{className:"text-center py-3",children:[l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:"No saved addresses found"}),l.jsx("a",{href:"#/user/manage-address",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Add an address to save time"})]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Country"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"IN"}),l.jsx("input",{type:"text",className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",value:je,readOnly:!0,disabled:!0})]})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3 w-full",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["First name ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"First name",value:Q,onChange:e=>J(e.target.value),required:!0})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Last name ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Last name",value:X,onChange:e=>Z(e.target.value),required:!0})]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Company (optional)"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Company",value:ee,onChange:e=>te(e.target.value)})]}),l.jsxs("div",{className:"mb-3",children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Address ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Street address",value:ne,onChange:e=>oe(e.target.value),required:!0})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Apartment, suite, etc."}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Apartment, suite, etc.",value:ce,onChange:e=>me(e.target.value)})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mb-3 w-full",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["City ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"City",value:xe,onChange:e=>ue(e.target.value),required:!0})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["State ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-slate-600 dark:text-slate-400 text-sm",children:"UP"}),l.jsx("select",{className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",value:pe,onChange:e=>he(e.target.value),required:!0,children:l.jsx("option",{value:"Uttar Pradesh",children:"Uttar Pradesh"})})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["PIN code ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"6-digit PIN code",value:be,onChange:e=>ge(e.target.value.replace(/\D/g,"").slice(0,6)),required:!0,pattern:"\\d{6}",minLength:6,maxLength:6}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Required for shipping"})]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Email ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{type:"email",className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"your@email.com",value:ae,onChange:e=>se(e.target.value),required:!0})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx(m,{value:re,onChange:e=>{const t=e.replace(/\D/g,"").slice(0,10);le(t)},onCountryCodeChange:ie,defaultCountry:de,placeholder:"Enter 10-digit phone number",required:!0,showLabel:!0,label:"Phone",className:"mb-3"}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Enter exactly 10 digits (required for shipping)"})]}),l.jsxs("div",{className:"space-y-2 mb-3",children:[l.jsxs("label",{className:"flex items-center",children:[l.jsx("input",{type:"checkbox",className:"mr-2 rounded border-slate-300",checked:ye,onChange:e=>Ne(e.target.checked)}),l.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Save this information for next time"})]}),l.jsxs("label",{className:"flex items-center",children:[l.jsx("input",{type:"checkbox",className:"mr-2 rounded border-slate-300",checked:ve,onChange:e=>ke(e.target.checked)}),l.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Text me with news and offers"})]})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Shipping method"}),l.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Enter your shipping address to view available shipping methods."})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Coupon Code"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600",placeholder:"Enter coupon code",value:H,onChange:e=>G(e.target.value.toUpperCase()),disabled:!!W}),W?l.jsx("button",{type:"button",onClick:()=>{K(null),G(""),M(null)},className:"rounded bg-red-600 px-4 py-2 font-semibold text-white hover:bg-red-700 transition-colors",children:"Remove"}):l.jsx("button",{type:"button",onClick:async()=>{try{const e=s(),t=await fetch(`${e}/api/discounts/apply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:H,amount:rt})});if(t.ok){const e=await t.json(),a=e.data||e;K(a),M(null)}else{const e=await t.json().catch(()=>({message:"Invalid discount code"}));M(e.message||"Invalid discount code"),K(null)}}catch(e){M("Failed to apply discount code")}},className:"rounded bg-green-600 px-4 py-2 font-semibold text-white hover:bg-green-700 disabled:opacity-50 transition-colors",disabled:!H.trim(),children:"Apply"})]}),W&&l.jsx("div",{className:"mt-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3",children:l.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["✅ Coupon applied: ",W.code," - Save ₹",it.toFixed(2)]})})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Payment"}),l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"All transactions are secure and encrypted."}),l.jsxs("div",{className:"space-y-3 mb-4",children:[k&&D>0&&l.jsx("div",{className:"p-4 rounded-lg border-2 border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-900/20 mb-4",children:l.jsxs("label",{className:"flex items-start cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:E,onChange:e=>{if(B(e.target.checked),e.target.checked){const e=Math.min(D,Math.ceil(10*mt));T(e),e/10<mt&&F("razorpay")}else T(0),F("cod")},className:"mt-1 mr-3"}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx(u,{className:"w-5 h-5 text-yellow-600"}),l.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:"Use Nefol Coins"})]}),l.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:["Available: ",D," coins (1 rupee = 10 coins)"]}),E&&l.jsxs("div",{className:"mt-3 space-y-2",children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:["Coins to Use (Max: ",Math.min(D,Math.ceil(10*mt))," coins)"]}),l.jsx("input",{type:"number",min:"0",max:Math.min(D,Math.ceil(10*mt)),value:L,onChange:e=>{const t=parseInt(e.target.value)||0,a=Math.min(D,Math.ceil(10*mt));T(Math.max(0,Math.min(t,a))),t/10<mt&&"coins"===I&&F("razorpay")},className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),l.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[l.jsxs("p",{children:["Coins value: ₹",(L/10).toFixed(2)]}),l.jsxs("p",{className:"font-semibold",children:["Remaining to pay: ₹",Math.max(0,mt-L/10).toFixed(2)]}),L/10>=mt&&l.jsx("p",{className:"text-green-600 dark:text-green-400 font-semibold",children:"✓ Order fully paid with coins! No additional payment needed."})]})]})]})]})}),E&&L/10<mt&&l.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:l.jsxs("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-200 mb-3",children:["Select Payment Method for Remaining Amount: ₹",Math.max(0,mt-L/10).toFixed(2)]})}),(!E||L/10<mt)&&l.jsxs("label",{className:"flex items-start p-4 rounded-lg border-2 cursor-pointer transition-all "+("razorpay"===I?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-300 dark:border-slate-600 hover:border-slate-400"),children:[l.jsx("input",{type:"radio",name:"paymentMethod",value:"razorpay",checked:"razorpay"===I,onChange:e=>F(e.target.value),disabled:E&&L/10>=mt,className:"mt-1 mr-3"}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:["Razorpay Secure (UPI, Cards, Int'l Cards, Wallets)",E&&L/10<mt&&l.jsxs("span",{className:"text-xs text-slate-500 ml-2",children:["(Pay ₹",Math.max(0,mt-L/10).toFixed(2),")"]})]}),l.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1 flex items-center gap-1",children:E&&L/10<mt?l.jsxs("span",{children:["Pay remaining ₹",Math.max(0,mt-L/10).toFixed(2)," via Razorpay"]}):l.jsxs(l.Fragment,{children:[l.jsx("span",{children:"UPI"}),l.jsx("span",{children:"•"}),l.jsx("span",{children:"Visa"}),l.jsx("span",{children:"•"}),l.jsx("span",{children:"Mastercard"}),l.jsx("span",{children:"•"}),l.jsx("span",{children:"Net Banking"}),l.jsx("span",{className:"ml-1",children:"+18"})]})})]})]}),(!E||L/10<mt)&&l.jsxs("label",{className:"flex items-start p-4 rounded-lg border-2 cursor-pointer transition-all "+("cod"===I?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-300 dark:border-slate-600 hover:border-slate-400"),children:[l.jsx("input",{type:"radio",name:"paymentMethod",value:"cod",checked:"cod"===I,onChange:e=>F(e.target.value),disabled:E&&L/10>=mt,className:"mt-1 mr-3"}),l.jsx("div",{className:"flex-1",children:l.jsxs("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:["Cash on Delivery (COD)",E&&L/10<mt&&l.jsxs("span",{className:"text-xs text-slate-500 ml-2",children:["(Pay ₹",Math.max(0,xt).toFixed(2)," on delivery)"]})]})})]})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Billing address"}),l.jsxs("label",{className:"flex items-center mb-4",children:[l.jsx("input",{type:"radio",name:"billingAddress",checked:we,onChange:()=>Pe(!0),className:"mr-2"}),l.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Same as shipping address"})]}),l.jsxs("label",{className:"flex items-center mb-4",children:[l.jsx("input",{type:"radio",name:"billingAddress",checked:!we,onChange:()=>Pe(!1),className:"mr-2"}),l.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Use a different billing address"})]}),!we&&l.jsxs("div",{className:"mt-4 space-y-4 pl-4 sm:pl-6 border-l-2 border-slate-300 dark:border-slate-600 w-full",children:[l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"First name"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"First name",value:Ce,onChange:e=>Se(e.target.value),required:!we})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Last name"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Last name",value:_e,onChange:e=>Me(e.target.value),required:!we})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Company (optional)"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Company",value:Ie,onChange:e=>Fe(e.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Address"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Address",value:qe,onChange:e=>ze(e.target.value),required:!we})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Apartment, suite, etc."}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Apartment, suite, etc.",value:Ue,onChange:e=>$e(e.target.value)})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 w-full",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"City"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"City",value:Re,onChange:e=>Ae(e.target.value),required:!we})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"State"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-slate-600 dark:text-slate-400 text-sm",children:"UP"}),l.jsx("select",{className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",value:De,onChange:e=>Oe(e.target.value),required:!we,children:l.jsx("option",{value:"Uttar Pradesh",children:"Uttar Pradesh"})})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["PIN code ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"6-digit PIN code",value:Le,onChange:e=>Te(e.target.value.replace(/\D/g,"").slice(0,6)),required:!we,pattern:"\\d{6}",minLength:6,maxLength:6}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Required for shipping"})]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx(m,{value:He,onChange:e=>{const t=e.replace(/\D/g,"").slice(0,10);Ge(t)},onCountryCodeChange:Ke,defaultCountry:We,placeholder:"Enter 10-digit phone number",required:!we,showLabel:!0,label:"Billing Phone",className:"mb-3"}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Enter exactly 10 digits (required for shipping)"})]})]})]}),_&&l.jsx("div",{className:"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 p-3 rounded-lg",children:_}),l.jsx("button",{type:"submit",disabled:C,className:"w-full rounded bg-blue-600 px-5 py-3 font-semibold text-white hover:bg-blue-700 disabled:opacity-50 transition-colors",children:C?"Processing Order...":E&&L/10>=mt?`Place Order (Paid with ${L} Coins)`:E&&L/10<mt?`Use ${L} Coins + Pay ₹${xt.toFixed(2)} ${pt?"(COD)":"razorpay"===I?"Now":""}`:pt?`Place Order (COD) - ₹${xt.toFixed(2)}`:"Pay now"})]}),l.jsxs("aside",{className:"w-full md:w-auto",children:[l.jsx("h2",{className:"text-xl font-semibold mb-3 dark:text-slate-100",children:"Order Summary"}),l.jsxs("div",{className:"space-y-3",children:[at.map(e=>l.jsxs("div",{className:"flex justify-between text-sm",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"dark:text-slate-300",children:[e.title," × ",e.quantity]}),l.jsx("div",{className:"text-xs",children:l.jsx(o,{product:e,csvProduct:e.csvProduct,className:"text-xs"})})]}),l.jsxs("span",{className:"dark:text-slate-100",children:["₹",(r(e.price)*e.quantity).toFixed(2)]})]},e.slug)),l.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-3 text-sm space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"MRP"}),l.jsxs("span",{className:"dark:text-slate-100",children:["₹",nt.toFixed(2)]})]}),ot>0&&l.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[l.jsx("span",{children:"Product Discount"}),l.jsxs("span",{children:["-₹",ot.toFixed(2)]})]}),l.jsxs("div",{className:"flex justify-between font-medium",children:[l.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Subtotal"}),l.jsxs("span",{className:"dark:text-slate-100",children:["₹",rt.toFixed(2)]})]}),W&&it>0&&l.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[l.jsxs("span",{children:["Coupon Code (",W.code,")"]}),l.jsxs("span",{children:["-₹",it.toFixed(2)]})]}),E&&L>0&&l.jsxs("div",{className:"flex justify-between text-yellow-600 dark:text-yellow-400",children:[l.jsxs("span",{children:["Nefol Coins Used (",L," coins = ₹",(L/10).toFixed(2),")"]}),l.jsxs("span",{children:["-₹",ct.toFixed(2)]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Shipping Charges"}),l.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Free"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsxs("span",{className:"text-slate-600 dark:text-slate-400",children:["GST (",w?(null==(b=null==(h=at[0])?void 0:h.category)?void 0:b.toLowerCase().includes("hair"))?"5%":"18%":"Mixed",")",l.jsx("span",{className:"text-xs ml-1",children:"(Inclusive)"})]}),l.jsxs("span",{className:"dark:text-slate-100",children:["₹",dt.toFixed(2)]})]}),l.jsx("div",{className:"border-t border-slate-300 dark:border-slate-600 pt-2 mt-2",children:l.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[l.jsx("span",{className:"dark:text-slate-100",children:"Grand Total"}),l.jsxs("span",{className:"dark:text-slate-100",children:["₹",xt.toFixed(2)]})]})}),l.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"* MRP includes GST"})]})]})]})]})})}):l.jsx(c,{children:l.jsx("main",{className:"py-10 dark:bg-slate-900",children:l.jsxs("div",{className:"mx-auto max-w-3xl px-4",children:[l.jsx("h1",{className:"text-2xl font-bold dark:text-slate-100",children:"Checkout"}),l.jsx("p",{className:"mt-2 text-slate-600 dark:text-slate-400",children:"Your cart is empty."})]})})})}export{p as default};
