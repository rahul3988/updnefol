import{j as e}from"./index-CEtbIVsH.js";import{r as t}from"./react-vendor-D-XgqoRR.js";import{r as s,J as a,Y as r,T as l,aq as d,P as n,I as i,ar as o}from"./ui-vendor-BjTBABCK.js";import"./socket-vendor-CUkmNz_4.js";function x(){const[x,c]=t.useState([]),[m,p]=t.useState(null),[h,u]=t.useState(!0),[f,g]=t.useState("all"),[j,v]=t.useState("date");t.useEffect(()=>{k()},[]);const k=async()=>{var e,t,s,a,r;try{const l=localStorage.getItem("token");if(!l)return c([]),void p(null);const d=await fetch("http://192.168.1.36:2000/api/affiliate/referrals",{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(d.ok){const l=await d.json();c(l.referrals||[]);const n=(null==(e=l.referrals)?void 0:e.length)||0,i=(null==(t=l.referrals)?void 0:t.filter(e=>"active"===e.status).length)||0,o=(null==(s=l.referrals)?void 0:s.reduce((e,t)=>e+(t.commission_earned||0),0))||0,x=(null==(a=l.referrals)?void 0:a.reduce((e,t)=>e+(t.total_orders||0),0))||0,m=(null==(r=l.referrals)?void 0:r.reduce((e,t)=>e+(t.total_spent||0),0))||0;p({total_referrals:n,active_referrals:i,total_commission:o,total_orders:x,total_spent:m,average_order_value:x>0?m/x:0,conversion_rate:n>0?i/n*100:0})}else c([]),p(null)}catch(l){c([]),p(null)}finally{u(!1)}},N=[...x.filter(e=>"all"===f||e.status===f)].sort((e,t)=>{switch(j){case"date":return new Date(t.signup_date).getTime()-new Date(e.signup_date).getTime();case"commission":return t.commission_earned-e.commission_earned;case"orders":return t.total_orders-e.total_orders;default:return 0}});return h?e.jsx("main",{className:"py-10 dark:bg-slate-900 min-h-screen flex items-center justify-center"}):e.jsx("main",{className:"py-10 dark:bg-slate-900 min-h-screen",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>window.location.hash="#/user/affiliate-partner",className:"flex items-center gap-2 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 transition-colors mb-4",children:[e.jsx(s,{className:"h-4 w-4"}),"Back to Affiliate Dashboard"]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"Referral History"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Track and analyze your referral performance"})]}),e.jsxs("button",{onClick:()=>{const e=[["Name","Email","Signup Date","Orders","Total Spent","Commission","Status","Conversion Rate"].join(","),...N.map(e=>[e.name,e.email,e.signup_date,e.total_orders,e.total_spent,e.commission_earned,e.status,e.conversion_rate].join(","))].join("\n"),t=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`referral-history-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(a,{className:"h-4 w-4"}),"Export CSV"]})]})]}),m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 font-medium",children:"Total Referrals"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:m.total_referrals})]}),e.jsx(r,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 font-medium",children:"Active Referrals"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:m.active_referrals})]}),e.jsx(l,{className:"h-8 w-8 text-green-600 dark:text-green-400"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400 font-medium",children:"Total Commission"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:["₹",m.total_commission.toFixed(2)]})]}),e.jsx(d,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400 font-medium",children:"Avg Order Value"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:["₹",m.average_order_value.toFixed(0)]})]}),e.jsx(n,{className:"h-8 w-8 text-orange-600 dark:text-orange-400"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 font-medium",children:"Conversion Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:[m.conversion_rate.toFixed(1),"%"]})]}),e.jsx(i,{className:"h-8 w-8 text-red-600 dark:text-red-400"})]})})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"h-4 w-4 text-slate-500"}),e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Filter:"}),e.jsxs("select",{value:f,onChange:e=>g(e.target.value),className:"px-3 py-1 border border-slate-300 dark:border-slate-600 rounded-lg text-sm dark:bg-slate-700 dark:text-slate-100",children:[e.jsx("option",{value:"all",children:"All Referrals"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"inactive",children:"Inactive Only"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Sort by:"}),e.jsxs("select",{value:j,onChange:e=>v(e.target.value),className:"px-3 py-1 border border-slate-300 dark:border-slate-600 rounded-lg text-sm dark:bg-slate-700 dark:text-slate-100",children:[e.jsx("option",{value:"date",children:"Signup Date"}),e.jsx("option",{value:"commission",children:"Commission"}),e.jsx("option",{value:"orders",children:"Order Count"})]})]})]}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Showing ",N.length," of ",x.length," referrals"]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Referral"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Signup Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Orders"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Total Spent"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Conversion"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:N.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:t.name}),e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:t.email})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100",children:new Date(t.signup_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100",children:t.total_orders}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100",children:["₹",t.total_spent.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100",children:["₹",t.commission_earned.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("active"===t.status?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400"),children:t.status})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100",children:[t.conversion_rate,"%"]})]},t.id))})]})})}),0===N.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(r,{className:"h-16 w-16 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold dark:text-slate-100 mb-2",children:"No Referrals Found"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No referrals match your current filter criteria"})]})]})})}export{x as default};
