import{r as e}from"./react-vendor-D-XgqoRR.js";import{g as t}from"./index-DMwW_ks9.js";function r(){const[r,a]=e.useState([]),[i,s]=e.useState(!0),[n,o]=e.useState(null),d=e.useCallback(async()=>{try{s(!0),o(null);const e=t(),r=await fetch(`${e}/api/products`,{credentials:"include",cache:"default"});if(!r.ok)throw new Error("Failed to load products");const i=await r.json(),n=t=>{if(!t||"string"!=typeof t)return"";if(/^https?:\/\//i.test(t))return t;return`${e.replace(/\/$/,"")}${t.startsWith("/")?t:`/${t}`}`},d=(i||[]).map(e=>{const t=n(e.list_image||""),r=function(e,t){return e.pdp_images&&Array.isArray(e.pdp_images)&&e.pdp_images.length?e.pdp_images.map(e=>t(e)):e.list_image?[t(e.list_image)]:[]}(e,n),a=function(e,t){return e.banner_images&&Array.isArray(e.banner_images)&&e.banner_images.length?e.banner_images.map(e=>t(e)):[]}(e,n);return{id:e.id,slug:e.slug,title:e.title,category:e.category,price:e.price,listImage:t,pdpImages:r,bannerImages:a,description:e.description||"",details:e.details||{}}}).filter(e=>e.slug&&e.title);a(d)}catch(e){o((null==e?void 0:e.message)||"Failed to load products")}finally{s(!1)}},[]);return e.useEffect(()=>{d()},[d]),e.useEffect(()=>{const e=()=>{d()};return window.addEventListener("product-updated",e),window.addEventListener("refresh-products",e),()=>{window.removeEventListener("product-updated",e),window.removeEventListener("refresh-products",e)}},[d]),{items:r,loading:i,error:n,refresh:d}}export{r as u};
