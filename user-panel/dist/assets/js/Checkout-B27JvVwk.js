import{d as e,u as t,b as a,g as s,i as r,j as l,p as d,n as i}from"./index-DJEU1c_F.js";import{r as n}from"./react-vendor-D-XgqoRR.js";import{P as o}from"./PricingDisplay-DwVQcRTb.js";import{A as c}from"./AuthGuard-CNCQIcdg.js";import{P as m}from"./PhoneInput-BmBNC-8t.js";import{i as u,q as x}from"./ui-vendor-D0H4cakl.js";import"./socket-vendor-CUkmNz_4.js";const p={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function h({affiliateId:h}){var b,g;const y=e(),f=(null==y?void 0:y.items)||[],v=(null==y?void 0:y.subtotal)||0,j=(null==y?void 0:y.tax)||0;null==y||y.total;const k=null==y?void 0:y.clear,{user:N,isAuthenticated:w}=t(),[P,C]=n.useState(null),[S,_]=n.useState(!1),[I,$]=n.useState(null),[M,z]=n.useState("cod"),[F,q]=n.useState("prepaid"),[U,O]=n.useState([]),[A,D]=n.useState(0),[R,L]=n.useState(0),[T,E]=n.useState(0),[B,H]=n.useState(!1),[G,V]=n.useState(""),[W,K]=n.useState(null),[Y,Q]=n.useState({}),[J,X]=n.useState(""),[Z,ee]=n.useState(""),[te,ae]=n.useState(""),[se,re]=n.useState(""),[le,de]=n.useState(""),[ie,ne]=n.useState("+91"),[oe,ce]=n.useState(""),[me,ue]=n.useState(""),[xe,pe]=n.useState(""),[he,be]=n.useState("Uttar Pradesh"),[ge,ye]=n.useState(""),[fe,ve]=n.useState("India"),[je,ke]=n.useState(!1),[Ne,we]=n.useState(!1),[Pe,Ce]=n.useState(""),[Se,_e]=n.useState(!0),[Ie,$e]=n.useState(""),[Me,ze]=n.useState(""),[Fe,qe]=n.useState(""),[Ue,Oe]=n.useState(""),[Ae,De]=n.useState(""),[Re,Le]=n.useState(""),[Te,Ee]=n.useState("Uttar Pradesh"),[Be,He]=n.useState(""),[Ge,Ve]=n.useState("India"),[We,Ke]=n.useState(""),[Ye,Qe]=n.useState("+91"),[Je,Xe]=n.useState([]),[Ze,et]=n.useState("");n.useEffect(()=>{var e,t,a,s;const r=new URL(window.location.href).hash.split("?")[1]||"",l=new URLSearchParams(r).get("buy");if(C(l),w&&N){const r=(N.name||"").split(" ");X(r[0]||""),ee(r.slice(1).join(" ")||""),re(N.email||""),de(N.phone||""),ce((null==(e=N.address)?void 0:e.street)||""),pe((null==(t=N.address)?void 0:t.city)||""),be((null==(a=N.address)?void 0:a.state)||"Uttar Pradesh"),ye((null==(s=N.address)?void 0:s.zip)||""),ve("India"),D(N.loyalty_points||0)}dt(),rt(),w&&(st(),tt())},[w,N]);const tt=async()=>{try{const e=await a.user.getAddresses();if(e&&e.length>0){Xe(e);const t=e.find(e=>e.is_default);t&&(et(String(t.id)),at(t))}}catch(e){}},at=e=>{const t=(e.name||"").split(" ");X(t[0]||""),ee(t.slice(1).join(" ")||""),de(e.phone||""),ce(e.street||""),ue(e.area||""),pe(e.city||""),be(e.state||"Uttar Pradesh"),ye(e.zip||""),ve(e.country||"India")},st=async()=>{try{const t=localStorage.getItem("token");if(!t)return;const a=s(),r=await fetch(`${a}/api/nefol-coins`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});let l=0;if(r.ok){l=(await r.json()).nefol_coins||0}let d=0;if(w&&t)try{const e=await fetch(`${a}/api/affiliate/dashboard`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(e.ok){const t=await e.json();t.total_earnings&&(d=Math.floor(10*t.total_earnings))}else e.status}catch(e){e instanceof TypeError&&e.message.includes("fetch")}L(l+d)}catch(e){}},rt=async()=>{try{const e=s(),t=await fetch(`${e}/api/products-csv`);if(t.ok){const e=await t.json(),a={};e.forEach(e=>{var t;const s={};Object.keys(e).forEach(t=>{const a=t.trim();s[a]=e[t]});const r=s.Slug||(null==(t=s["Product Name"])?void 0:t.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""))||"";r&&(a[r]=s)}),Q(a)}}catch(e){}},lt=n.useMemo(()=>(P?f.filter(e=>e.slug===P):f).map(e=>{const t=Y[e.slug];return{...e,csvProduct:t||null}}),[P,f,Y]),dt=async()=>{try{(null==p?void 0:p.VITE_BACKEND_HOST)||(null==p?void 0:p.VITE_API_HOST)||window.location.hostname;const e=s(),t=await fetch(`${e}/api/payment-gateways`);if(t.ok){const e=await t.json();O(e.filter(e=>e.is_active))}}catch(e){}},it=n.useMemo(()=>P?lt.reduce((e,t)=>e+r(t.price)*(t.quantity||1),0):v,[P,lt,v]),nt=()=>{if(!W)return 0;if(void 0!==W.discountAmount)return W.discountAmount;if("percentage"===W.type){let e=it*W.value/100;return W.maxDiscount&&e>W.maxDiscount&&(e=W.maxDiscount),e}return W.value},ot=(()=>{if(P){const e=lt[0];if(!e)return 0;const t=r(e.price);return(t-t/(1+((e.category||"").toLowerCase().includes("hair")?.05:.18)))*(e.quantity||1)}return j})(),ct=nt(),mt=lt.reduce((e,t)=>{var a,s,l;let d=null;if(t.mrp)d=t.mrp;else if(null==(a=t.details)?void 0:a.mrp)d=t.details.mrp;else if(null==(l=null==(s=t.product)?void 0:s.details)?void 0:l.mrp)d=t.product.details.mrp;else if(t.csvProduct){const e=t.csvProduct;d=e["MRP (₹)"]||e["MRP "]||e.MRP||e.mrp||e["MRP(₹)"]||e["MRP(₹) "]}d||(d=t.price);const i=r(d||"0");return e+i*(t.quantity||1)},0),ut=lt.reduce((e,t)=>{var a,s,l;let d=null;if(t.mrp)d=t.mrp;else if(null==(a=t.details)?void 0:a.mrp)d=t.details.mrp;else if(null==(l=null==(s=t.product)?void 0:s.details)?void 0:l.mrp)d=t.product.details.mrp;else if(t.csvProduct){const e=t.csvProduct;d=e["MRP (₹)"]||e["MRP "]||e.MRP||e.mrp||e["MRP(₹)"]||e["MRP(₹) "]}d||(d=t.price);const i=(r(d||"0")-r(t.price))*(t.quantity||1);return e+Math.max(0,i)},0),xt=B?Math.min(T/10,it-ct):0,pt=it-ct-xt,ht=P?Math.max(0,pt+0):Math.max(0,v-ct-xt+0),bt=ht<1e3,gt="cod"===M;n.useEffect(()=>{bt||q("prepaid")},[bt]);const yt=()=>lt.map(e=>{const t=Y[e.slug]||{};return{...e,csvProduct:{"Brand Name":t["Brand Name"],SKU:t.SKU,"HSN Code":t["HSN Code"],"Net Quantity (Content)":t["Net Quantity (Content)"],"Unit Count (Pack of)":t["Unit Count (Pack of)"],"Net Weight (Product Only)":t["Net Weight (Product Only)"],"Dead Weight (Packaging Only)":t["Dead Weight (Packaging Only)"],"GST %":t["GST %"],"Country of Origin":t["Country of Origin"],"Manufacturer / Packer / Importer":t["Manufacturer / Packer / Importer"],"Key Ingredients":t["Key Ingredients"],"Ingredient Benefits":t["Ingredient Benefits"],"How to Use (Steps)":t["How to Use (Steps)"],"Package Content Details":t["Package Content Details"],"Inner Packaging Type":t["Inner Packaging Type"],"Outer Packaging Type":t["Outer Packaging Type"],"Hazardous / Fragile (Y/N)":t["Hazardous / Fragile (Y/N)"],"Special Attributes (Badges)":t["Special Attributes (Badges)"],"Product Category":t["Product Category"],"Product Sub-Category":t["Product Sub-Category"],"Product Type":t["Product Type"],"Skin/Hair Type":t["Skin/Hair Type"],MRP:t.MRP,"website price":t["website price"],discount:t.discount,"Image Links":t["Image Links"],"Video Links":t["Video Links"]}}}),ft=(e,t)=>{const a=e.replace(/\D/g,"");return a.length>10?a.slice(-10):10===a.length?a:a.padStart(10,"0").slice(-10)};return lt.length?l.jsx(c,{children:l.jsx("main",{className:"py-10 dark:bg-slate-900 w-full overflow-x-hidden",children:l.jsxs("div",{className:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 w-full",children:[l.jsxs("form",{onSubmit:async e=>{e.preventDefault(),$(null);const t=(()=>{if(!(null==J?void 0:J.trim()))return"First name is required";if(!(null==Z?void 0:Z.trim()))return"Last name is required";if(!(null==oe?void 0:oe.trim()))return"Address is required";if(!(null==xe?void 0:xe.trim()))return"City is required";if(!(null==he?void 0:he.trim()))return"State is required";if(!(null==ge?void 0:ge.trim()))return"PIN code is required";if(!(null==le?void 0:le.trim()))return"Phone number is required";if(!(null==se?void 0:se.trim()))return"Email is required";if(10!==le.replace(/\D/g,"").length)return"Please enter a valid 10-digit phone number";if(!Se){if(!(null==We?void 0:We.trim()))return"Billing phone number is required";if(10!==We.replace(/\D/g,"").length)return"Please enter a valid 10-digit billing phone number"}const e=/^\d{6}$/,t=ge.replace(/\D/g,"");if(6!==t.length||!e.test(t))return"Please enter a valid 6-digit PIN code";if(!Se&&Be){const t=Be.replace(/\D/g,"");if(6!==t.length||!e.test(t))return"Please enter a valid 6-digit billing PIN code"}return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(se)?null:"Please enter a valid email address"})();if(t)$(t);else if(B&&T/10<pt&&!M)$("Please select a payment method for the remaining amount");else{_(!0);try{if("razorpay"===M)return void(await(async()=>{var e;try{const e=`NEFOL-${Date.now()}`,r=yt(),l=nt(),n={order_number:e,customer_name:`${J} ${Z}`.trim(),customer_email:se,shipping_address:{firstName:J.trim(),lastName:Z.trim(),company:te.trim()||void 0,gst_number:te.trim()?Pe.trim():void 0,address:oe.trim(),apartment:me.trim()||void 0,city:xe.trim(),state:he.trim(),zip:ge.trim(),pincode:ge.trim(),phone:ft(le,ie),country:fe||"India",email:se.trim()},billing_address:Se?{firstName:J.trim(),lastName:Z.trim(),company:te.trim()||void 0,address:oe.trim(),apartment:me.trim()||void 0,city:xe.trim(),state:he.trim(),zip:ge.trim(),country:fe||"India",phone:ft(le,ie),email:se.trim()}:{firstName:Ie.trim(),lastName:Me.trim(),company:Fe.trim()||void 0,address:Ue.trim(),apartment:Ae.trim()||void 0,city:Re.trim(),state:Te.trim(),zip:Be.trim(),pincode:Be.trim(),country:Ge||"India",phone:ft(We||le,Ye||ie),email:se.trim()},items:r,subtotal:Number(it.toFixed(2)),shipping:0,tax:ot,total:Number(ht.toFixed(2)),payment_method:B&&T>0?"coins+razorpay":"razorpay",payment_type:F,status:"created",affiliate_id:h,discount_code:(null==W?void 0:W.code)||null,discount_amount:l>0?Number(l.toFixed(2)):0,coins_used:B?T:0};await a.orders.createOrder(n);const o=await a.payment.createRazorpayOrder({amount:ht,currency:"INR",order_number:e,customer_name:`${J} ${Z}`.trim(),customer_email:se,customer_phone:`${ie}${ft(le,ie)}`});if(!o||!o.id||!o.key_id)return $("Failed to initialize payment gateway. Please try again."),void _(!1);if(!o.id.startsWith("order_"))return $("Invalid payment order. Please try again."),void _(!1);const c={key:o.key_id,amount:o.amount,currency:o.currency,name:"Nefol",description:`Order ${e}`,order_id:o.id,prefill:{name:`${J} ${Z}`.trim(),email:se,contact:`${ie}${ft(le,ie)}`},handler:async function(t){var s;try{if(!t.razorpay_order_id||!t.razorpay_payment_id||!t.razorpay_signature)return $("Payment verification failed: Invalid payment response"),void _(!1);if(!e)return $("Payment verification failed: Order number is missing"),void _(!1);if(await a.payment.verifyRazorpayPayment({razorpay_order_id:t.razorpay_order_id,razorpay_payment_id:t.razorpay_payment_id,razorpay_signature:t.razorpay_signature,order_number:e}),d.purchase(i({...n,order_number:e,items:r})),je&&w)try{await a.user.createAddress({name:`${J} ${Z}`.trim(),phone:ft(le,ie),street:oe.trim(),area:me.trim()||void 0,city:xe.trim(),state:he.trim(),zip:ge.trim(),country:fe||"India",is_default:!0})}catch(l){}if(Ne&&le)try{await a.whatsapp.subscribe(`${ie}${ft(le,ie)}`,`${J} ${Z}`.trim(),"checkout")}catch(l){}k&&k(),window.location.hash=`#/user/confirmation?order=${encodeURIComponent(e)}`}catch(l){const t=(null==l?void 0:l.message)||(null==(s=null==l?void 0:l.error)?void 0:s.message)||"Payment verification failed. Please contact support if payment was deducted.";$(t),_(!1);try{await a.orders.updatePaymentCancelled(e)}catch(o){}}},modal:{ondismiss:async function(){_(!1);try{await a.orders.updatePaymentCancelled(e)}catch(t){}}}},m=window.Razorpay(c);m.on("payment.failed",function(e){var t,a;$(`Payment failed: ${(null==(t=e.error)?void 0:t.description)||(null==(a=e.error)?void 0:a.reason)||"Unknown error"}`),_(!1)}),m.on("payment.error",function(e){var t,a;$(`Payment error: ${(null==(t=e.error)?void 0:t.description)||(null==(a=e.error)?void 0:a.reason)||"Unknown error"}`),_(!1)});try{m.open()}catch(t){$(`Failed to open payment gateway: ${(null==t?void 0:t.message)||"Unknown error"}`),_(!1);try{await a.orders.updatePaymentCancelled(e)}catch(s){}}}catch(r){$((null==r?void 0:r.message)||(null==(e=null==r?void 0:r.error)?void 0:e.message)||"Payment initiation failed"),_(!1)}})());const e=`NEFOL-${Date.now()}`,t=yt(),r=nt(),l={order_number:e,customer_name:`${J} ${Z}`.trim(),customer_email:se,shipping_address:{firstName:J.trim(),lastName:Z.trim(),company:te.trim()||void 0,gst_number:te.trim()?Pe.trim():void 0,address:oe.trim(),apartment:me.trim()||void 0,city:xe.trim(),state:he.trim(),zip:ge.trim(),pincode:ge.trim(),phone:ft(le,ie),country:fe||"India",email:se.trim()},billing_address:Se?{firstName:J.trim(),lastName:Z.trim(),company:te.trim()||void 0,address:oe.trim(),apartment:me.trim()||void 0,city:xe.trim(),state:he.trim(),zip:ge.trim(),country:fe||"India",phone:ft(le,ie),email:se.trim()}:{firstName:Ie.trim(),lastName:Me.trim(),company:Fe.trim()||void 0,address:Ue.trim(),apartment:Ae.trim()||void 0,city:Re.trim(),state:Te.trim(),zip:Be.trim(),pincode:Be.trim(),country:Ge||"India",phone:ft(We||le,Ye||ie),email:se.trim()},items:t,subtotal:Number(it.toFixed(2)),shipping:0,tax:ot,total:Number(ht.toFixed(2)),payment_method:B&&T/10>=pt?"coins":M,payment_type:gt?"cod":B&&T/10>=pt?"prepaid":F,status:"created",affiliate_id:h,discount_code:(null==W?void 0:W.code)||null,discount_amount:r>0?Number(r.toFixed(2)):0,coins_used:B?T:0},n=await a.orders.createOrder(l);if(d.purchase(i({...l,order_number:n.order_number||e,items:t})),je&&w)try{await a.user.createAddress({name:`${J} ${Z}`.trim(),phone:ft(le,ie),street:oe.trim(),area:me.trim()||void 0,city:xe.trim(),state:he.trim(),zip:ge.trim(),country:fe||"India",is_default:!0})}catch(s){}if(Ne&&le)try{await a.whatsapp.subscribe(`${ie}${ft(le,ie)}`,`${J} ${Z}`.trim(),"checkout")}catch(s){}k&&k(),window.location.hash=`#/user/confirmation?order=${encodeURIComponent(n.order_number||e)}`}catch(s){$((null==s?void 0:s.message)||"Order failed")}finally{_(!1)}}},className:"md:col-span-2 space-y-6",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold dark:text-slate-100 mb-4",children:"Delivery"}),l.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:["Fields marked with ",l.jsx("span",{className:"text-red-500",children:"*"})," are required for shipping. Please ensure all information is accurate."]}),w&&l.jsxs("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx(u,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),l.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Use Saved Address"})]}),Je.length>0?l.jsxs(l.Fragment,{children:[l.jsxs("select",{value:Ze,onChange:e=>(e=>{et(e);const t=Je.find(t=>String(t.id)===e);t&&at(t)})(e.target.value),className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-700 dark:text-slate-100 mb-2 font-medium",children:[l.jsx("option",{value:"",children:"Select a saved address..."}),Je.map(e=>l.jsxs("option",{value:String(e.id),children:[e.name||"Unnamed"," - ",e.street,", ",e.city,", ",e.state," ",e.zip,e.is_default&&" (Default)"]},e.id))]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Select a saved address to autofill the form below"}),l.jsx("a",{href:"#/user/manage-address",className:"text-xs text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Manage Addresses"})]}),Ze&&l.jsx("button",{type:"button",onClick:()=>{et(""),X(""),ee(""),de(""),ce(""),ue(""),pe(""),be("Uttar Pradesh"),ye("")},className:"mt-3 text-sm text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Use new address instead"})]}):l.jsxs("div",{className:"text-center py-3",children:[l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:"No saved addresses found"}),l.jsx("a",{href:"#/user/manage-address",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Add an address to save time"})]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Country"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"IN"}),l.jsx("input",{type:"text",className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",value:fe,readOnly:!0,disabled:!0})]})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3 w-full",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["First name ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"First name",value:J,onChange:e=>X(e.target.value),required:!0})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Last name ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Last name",value:Z,onChange:e=>ee(e.target.value),required:!0})]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Company (optional)"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Company",value:te,onChange:e=>ae(e.target.value)})]}),te.trim()&&l.jsxs("div",{className:"mb-3",children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["GST Number ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Enter 14-digit GST number",value:Pe,onChange:e=>Ce(e.target.value.replace(/\D/g,"").slice(0,14)),required:""!==te.trim(),pattern:"[0-9]{14}",minLength:14,maxLength:14}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Enter exactly 14 digits (required for company orders)"})]}),l.jsxs("div",{className:"mb-3",children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Address ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Street address",value:oe,onChange:e=>ce(e.target.value),required:!0})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Apartment, suite, etc."}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Apartment, suite, etc.",value:me,onChange:e=>ue(e.target.value)})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mb-3 w-full",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["City ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"City",value:xe,onChange:e=>pe(e.target.value),required:!0})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["State ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-slate-600 dark:text-slate-400 text-sm",children:"UP"}),l.jsx("select",{className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",value:he,onChange:e=>be(e.target.value),required:!0,children:l.jsx("option",{value:"Uttar Pradesh",children:"Uttar Pradesh"})})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["PIN code ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"6-digit PIN code",value:ge,onChange:e=>ye(e.target.value.replace(/\D/g,"").slice(0,6)),required:!0,pattern:"\\d{6}",minLength:6,maxLength:6}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Required for shipping"})]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Email ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{type:"email",className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"your@email.com",value:se,onChange:e=>re(e.target.value),required:!0})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx(m,{value:le,onChange:e=>{const t=e.replace(/\D/g,"").slice(0,10);de(t)},onCountryCodeChange:ne,defaultCountry:ie,placeholder:"Enter 10-digit phone number",required:!0,showLabel:!0,label:"Phone",className:"mb-3"}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Enter exactly 10 digits (required for shipping)"})]}),l.jsxs("div",{className:"space-y-2 mb-3",children:[l.jsxs("label",{className:"flex items-center",children:[l.jsx("input",{type:"checkbox",className:"mr-2 rounded border-slate-300",checked:je,onChange:e=>ke(e.target.checked)}),l.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Save this information for next time"})]}),l.jsxs("label",{className:"flex items-center",children:[l.jsx("input",{type:"checkbox",className:"mr-2 rounded border-slate-300",checked:Ne,onChange:e=>we(e.target.checked)}),l.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Text me with news and offers"})]})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Shipping method"}),l.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Enter your shipping address to view available shipping methods."})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Coupon Code"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600",placeholder:"Enter coupon code",value:G,onChange:e=>V(e.target.value.toUpperCase()),disabled:!!W}),W?l.jsx("button",{type:"button",onClick:()=>{K(null),V(""),$(null)},className:"rounded bg-red-600 px-4 py-2 font-semibold text-white hover:bg-red-700 transition-colors",children:"Remove"}):l.jsx("button",{type:"button",onClick:async()=>{try{if(!G||""===G.trim())return void $("Please enter a discount code");if(!it||it<=0)return void $("Order amount must be greater than zero");const e=s(),t=await fetch(`${e}/api/discounts/apply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:G.trim(),amount:it})});if(t.ok){const e=await t.json(),a=e.data||e;K(a),$(null)}else{const e=await t.json().catch(()=>({message:"Failed to apply discount code"})),a=e.message||e.error||"Invalid discount code";$(a),K(null)}}catch(e){$((null==e?void 0:e.message)||"Failed to apply discount code. Please try again."),K(null)}},className:"rounded bg-green-600 px-4 py-2 font-semibold text-white hover:bg-green-700 disabled:opacity-50 transition-colors",disabled:!G.trim(),children:"Apply"})]}),W&&l.jsx("div",{className:"mt-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3",children:l.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["✅ Coupon applied: ",W.code," - Save ₹",ct.toFixed(2)]})})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Payment"}),l.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"All transactions are secure and encrypted."}),l.jsxs("div",{className:"space-y-3 mb-4",children:[w&&R>0&&l.jsx("div",{className:"p-4 rounded-lg border-2 border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-900/20 mb-4",children:l.jsxs("label",{className:"flex items-start cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:B,onChange:e=>{if(H(e.target.checked),e.target.checked){const e=Math.min(R,Math.ceil(10*pt));E(e),e/10<pt&&z("razorpay")}else E(0),z("cod")},className:"mt-1 mr-3"}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx(x,{className:"w-5 h-5 text-yellow-600"}),l.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:"Use Nefol Coins"})]}),l.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:["Available: ",R," coins (1 rupee = 10 coins)"]}),B&&l.jsxs("div",{className:"mt-3 space-y-2",children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:["Coins to Use (Max: ",Math.min(R,Math.ceil(10*pt))," coins)"]}),l.jsx("input",{type:"number",min:"0",max:Math.min(R,Math.ceil(10*pt)),value:T,onChange:e=>{const t=parseInt(e.target.value)||0,a=Math.min(R,Math.ceil(10*pt));E(Math.max(0,Math.min(t,a))),t/10<pt&&"coins"===M&&z("razorpay")},className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),l.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[l.jsxs("p",{children:["Coins value: ₹",(T/10).toFixed(2)]}),l.jsxs("p",{className:"font-semibold",children:["Remaining to pay: ₹",Math.max(0,pt-T/10).toFixed(2)]}),T/10>=pt&&l.jsx("p",{className:"text-green-600 dark:text-green-400 font-semibold",children:"✓ Order fully paid with coins! No additional payment needed."})]})]})]})]})}),B&&T/10<pt&&l.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:l.jsxs("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-200 mb-3",children:["Select Payment Method for Remaining Amount: ₹",Math.max(0,pt-T/10).toFixed(2)]})}),(!B||T/10<pt)&&l.jsxs("label",{className:"flex items-start p-4 rounded-lg border-2 cursor-pointer transition-all "+("razorpay"===M?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-300 dark:border-slate-600 hover:border-slate-400"),children:[l.jsx("input",{type:"radio",name:"paymentMethod",value:"razorpay",checked:"razorpay"===M,onChange:e=>z(e.target.value),disabled:B&&T/10>=pt,className:"mt-1 mr-3"}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:["Razorpay Secure (UPI, Cards, Int'l Cards, Wallets)",B&&T/10<pt&&l.jsxs("span",{className:"text-xs text-slate-500 ml-2",children:["(Pay ₹",Math.max(0,pt-T/10).toFixed(2),")"]})]}),l.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1 flex items-center gap-1",children:B&&T/10<pt?l.jsxs("span",{children:["Pay remaining ₹",Math.max(0,pt-T/10).toFixed(2)," via Razorpay"]}):l.jsxs(l.Fragment,{children:[l.jsx("span",{children:"UPI"}),l.jsx("span",{children:"•"}),l.jsx("span",{children:"Visa"}),l.jsx("span",{children:"•"}),l.jsx("span",{children:"Mastercard"}),l.jsx("span",{children:"•"}),l.jsx("span",{children:"Net Banking"}),l.jsx("span",{className:"ml-1",children:"+18"})]})})]})]}),(!B||T/10<pt)&&l.jsxs("label",{className:"flex items-start p-4 rounded-lg border-2 cursor-pointer transition-all "+("cod"===M?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-300 dark:border-slate-600 hover:border-slate-400"),children:[l.jsx("input",{type:"radio",name:"paymentMethod",value:"cod",checked:"cod"===M,onChange:e=>z(e.target.value),disabled:B&&T/10>=pt,className:"mt-1 mr-3"}),l.jsx("div",{className:"flex-1",children:l.jsxs("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:["Cash on Delivery (COD)",B&&T/10<pt&&l.jsxs("span",{className:"text-xs text-slate-500 ml-2",children:["(Pay ₹",Math.max(0,ht).toFixed(2)," on delivery)"]})]})})]})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-xl font-bold dark:text-slate-100 mb-4",children:"Billing address"}),l.jsxs("label",{className:"flex items-center mb-4",children:[l.jsx("input",{type:"radio",name:"billingAddress",checked:Se,onChange:()=>_e(!0),className:"mr-2"}),l.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Same as shipping address"})]}),l.jsxs("label",{className:"flex items-center mb-4",children:[l.jsx("input",{type:"radio",name:"billingAddress",checked:!Se,onChange:()=>_e(!1),className:"mr-2"}),l.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Use a different billing address"})]}),!Se&&l.jsxs("div",{className:"mt-4 space-y-4 pl-4 sm:pl-6 border-l-2 border-slate-300 dark:border-slate-600 w-full",children:[l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"First name"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"First name",value:Ie,onChange:e=>$e(e.target.value),required:!Se})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Last name"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Last name",value:Me,onChange:e=>ze(e.target.value),required:!Se})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Company (optional)"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Company",value:Fe,onChange:e=>qe(e.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Address"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Address",value:Ue,onChange:e=>Oe(e.target.value),required:!Se})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Apartment, suite, etc."}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"Apartment, suite, etc.",value:Ae,onChange:e=>De(e.target.value)})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 w-full",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"City"}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"City",value:Re,onChange:e=>Le(e.target.value),required:!Se})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"State"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-slate-600 dark:text-slate-400 text-sm",children:"UP"}),l.jsx("select",{className:"flex-1 rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",value:Te,onChange:e=>Ee(e.target.value),required:!Se,children:l.jsx("option",{value:"Uttar Pradesh",children:"Uttar Pradesh"})})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["PIN code ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:"w-full rounded border border-slate-300 px-3 py-2 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100",placeholder:"6-digit PIN code",value:Be,onChange:e=>He(e.target.value.replace(/\D/g,"").slice(0,6)),required:!Se,pattern:"\\d{6}",minLength:6,maxLength:6}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Required for shipping"})]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx(m,{value:We,onChange:e=>{const t=e.replace(/\D/g,"").slice(0,10);Ke(t)},onCountryCodeChange:Qe,defaultCountry:Ye,placeholder:"Enter 10-digit phone number",required:!Se,showLabel:!0,label:"Billing Phone",className:"mb-3"}),l.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Enter exactly 10 digits (required for shipping)"})]})]})]}),I&&l.jsx("div",{className:"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 p-3 rounded-lg",children:I}),l.jsx("button",{type:"submit",disabled:S,className:"w-full rounded bg-blue-600 px-5 py-3 font-semibold text-white hover:bg-blue-700 disabled:opacity-50 transition-colors",children:S?"Processing Order...":B&&T/10>=pt?`Place Order (Paid with ${T} Coins)`:B&&T/10<pt?`Use ${T} Coins + Pay ₹${ht.toFixed(2)} ${gt?"(COD)":"razorpay"===M?"Now":""}`:gt?`Place Order (COD) - ₹${ht.toFixed(2)}`:"Pay now"})]}),l.jsxs("aside",{className:"w-full md:w-auto",children:[l.jsx("h2",{className:"text-xl font-semibold mb-3 dark:text-slate-100",children:"Order Summary"}),l.jsxs("div",{className:"space-y-3",children:[lt.map(e=>l.jsxs("div",{className:"flex justify-between text-sm",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"dark:text-slate-300",children:[e.title," × ",e.quantity]}),l.jsx("div",{className:"text-xs",children:l.jsx(o,{product:e,csvProduct:e.csvProduct,className:"text-xs"})})]}),l.jsxs("span",{className:"dark:text-slate-100",children:["₹",(r(e.price)*e.quantity).toFixed(2)]})]},e.slug)),l.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-3 text-sm space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"MRP"}),l.jsxs("span",{className:"dark:text-slate-100",children:["₹",mt.toFixed(2)]})]}),ut>0&&l.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[l.jsx("span",{children:"Product Discount"}),l.jsxs("span",{children:["-₹",ut.toFixed(2)]})]}),l.jsxs("div",{className:"flex justify-between font-medium",children:[l.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Subtotal"}),l.jsxs("span",{className:"dark:text-slate-100",children:["₹",it.toFixed(2)]})]}),W&&ct>0&&l.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[l.jsxs("span",{children:["Coupon Code (",W.code,")"]}),l.jsxs("span",{children:["-₹",ct.toFixed(2)]})]}),B&&T>0&&l.jsxs("div",{className:"flex justify-between text-yellow-600 dark:text-yellow-400",children:[l.jsxs("span",{children:["Nefol Coins Used (",T," coins = ₹",(T/10).toFixed(2),")"]}),l.jsxs("span",{children:["-₹",xt.toFixed(2)]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Shipping Charges"}),l.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Free"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsxs("span",{className:"text-slate-600 dark:text-slate-400",children:["GST (",P?(null==(g=null==(b=lt[0])?void 0:b.category)?void 0:g.toLowerCase().includes("hair"))?"5%":"18%":"Mixed",")",l.jsx("span",{className:"text-xs ml-1",children:"(Inclusive)"})]}),l.jsxs("span",{className:"dark:text-slate-100",children:["₹",ot.toFixed(2)]})]}),l.jsx("div",{className:"border-t border-slate-300 dark:border-slate-600 pt-2 mt-2",children:l.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[l.jsx("span",{className:"dark:text-slate-100",children:"Grand Total"}),l.jsxs("span",{className:"dark:text-slate-100",children:["₹",ht.toFixed(2)]})]})}),l.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"* MRP includes GST"})]})]})]})]})})}):l.jsx(c,{children:l.jsx("main",{className:"py-10 dark:bg-slate-900",children:l.jsxs("div",{className:"mx-auto max-w-3xl px-4",children:[l.jsx("h1",{className:"text-2xl font-bold dark:text-slate-100",children:"Checkout"}),l.jsx("p",{className:"mt-2 text-slate-600 dark:text-slate-400",children:"Your cart is empty."})]})})})}export{h as default};
