import{d as e,c as t,g as s,k as r,j as a}from"./index-9SM8fWk5.js";import{r as l}from"./react-vendor-D-XgqoRR.js";import{b as i,c as n,T as o,af as c,ag as d,ah as m,e as u,d as p}from"./ui-vendor-upD1L4Zc.js";import"./socket-vendor-CUkmNz_4.js";function x(){const{addItem:x}=e(),{addToWishlist:g,removeFromWishlist:h,isInWishlist:b}=t(),[f,j]=l.useState(""),[v,y]=l.useState([]),[N,w]=l.useState(!1),[_,S]=l.useState(null),[k,C]=l.useState(null),[F,I]=l.useState(""),[P,A]=l.useState({min:"",max:""}),[E,T]=l.useState([]),[M,$]=l.useState(""),[R,L]=l.useState(""),[O,W]=l.useState("relevance"),[J,q]=l.useState("desc"),[U,z]=l.useState(!1),[B,D]=l.useState(!1),[G,H]=l.useState([]),[K,Q]=l.useState([]),[V,X]=l.useState([]),[Y,Z]=l.useState(1),[ee,te]=l.useState(1),[se,re]=l.useState(0),ae=l.useRef(null),le=l.useRef(null);l.useEffect(()=>{const e=window.location.hash||"#/",t=new URLSearchParams(e.split("?")[1]||"").get("q")||"";j(t),ne(t);const s=localStorage.getItem("nefol_recent_searches");if(s)try{X(JSON.parse(s))}catch(r){}},[]),l.useEffect(()=>{oe()},[]);const ie=e=>{var t,s;let r=e.details;if("string"==typeof r)try{r=JSON.parse(r)}catch(o){r={}}const a=Array.isArray(e.pdp_images)?e.pdp_images:[],l=[];for(let c=1;c<=6;c++){const t=`pdp_image_${c}`;e[t]&&l.push({url:e[t]})}const i=[...a,...l].filter(e=>e&&(e.url||"string"==typeof e)).map(e=>"string"==typeof e?{url:e}:e),n=[e.list_image,...i.map(e=>e.url),e.listImage,e.thumbnail,e.primary_image].find(e=>e&&e.trim().length>0)||"";return{id:(null==(s=null==(t=e.id)?void 0:t.toString)?void 0:s.call(t))||e.id,title:e.title,description:e.description,price:e.price,category:e.category,brand:e.brand,key_ingredients:e.key_ingredients,skin_type:e.skin_type,hair_type:e.hair_type,list_image:n,pdp_images:i,relevance_score:e.relevance_score??0,slug:e.slug,details:r}},ne=async(e,t=1)=>{w(!0),S(null);try{const a=new URLSearchParams({page:t.toString(),limit:"20",sortBy:O,sortOrder:J,...F&&{category:F},...P.min&&{minPrice:P.min},...P.max&&{maxPrice:P.max},...E.length>0&&{ingredients:E.join(",")},...M&&{skinType:M},...R&&{hairType:R}});e&&e.trim()&&a.set("q",e.trim());const l=await fetch(`${s()}/api/search?${a}`);if(!l.ok){await l.text();throw new Error(`Search failed: ${l.status}`)}const i=l.headers.get("content-type");if(!i||!i.includes("application/json")){await l.text();throw new Error("Server returned non-JSON response")}const n=await l.json(),o=(n.products||[]).map(ie);y(o),H(n.suggestions),Q(n.popularSearches),Z(n.pagination.page),te(n.pagination.totalPages),re(n.pagination.total),e&&e.trim()&&r.trackSearch(e.trim(),n.pagination.total||0);const c=e.trim()?`#/search?q=${encodeURIComponent(e)}`:"#/search";if(window.history.replaceState(null,"",c),e.trim()){const t=[e.trim(),...V.filter(t=>t!==e.trim())].slice(0,5);X(t),localStorage.setItem("nefol_recent_searches",JSON.stringify(t))}}catch(a){S("Failed to search products. Please try again.")}finally{w(!1)}},oe=async()=>{try{const e=await fetch(`${s()}/api/search/filters`);if(!e.ok){await e.text();return}const t=e.headers.get("content-type");if(!t||!t.includes("application/json")){await e.text();return}const r=await e.json();C(r)}catch(e){}},ce=()=>{f.trim()&&ne(f.trim())},de=()=>{I(""),A({min:"",max:""}),T([]),$(""),L(""),W("relevance"),q("desc"),f.trim()&&ne(f.trim())},me=e=>{Z(e),f.trim()&&ne(f.trim(),e)},ue=e=>{if(!e)return"";if(e.startsWith("http"))return e;if(e.startsWith("/IMAGES/"))return e;const t=e.startsWith("/")?e:`/${e}`;return`${s()}${t}`},pe=e=>{const t=[e.list_image,...Array.isArray(e.pdp_images)?e.pdp_images.map(e=>null==e?void 0:e.url):[],e.listImage,e.thumbnail,e.primary_image,e.pdp_image_1,e.pdp_image_2,e.pdp_image_3,e.pdp_image_4,e.pdp_image_5,e.pdp_image_6].find(e=>e&&e.trim().length>0)||"";return ue(t)},xe=e=>{j(e),ne(e),D(!1)};return l.useEffect(()=>{const e=e=>{le.current&&!le.current.contains(e.target)&&ae.current&&!ae.current.contains(e.target)&&D(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 py-8",children:a.jsxs("div",{className:"mx-auto max-w-7xl px-4",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-4xl font-bold text-gradient-primary mb-4",children:"Advanced Search"}),a.jsx("p",{className:"text-slate-600 text-lg",children:"Find the perfect products with intelligent search and filters"})]}),a.jsx("div",{className:"mb-8 relative",children:a.jsx("form",{onSubmit:e=>{e.preventDefault(),f.trim()&&(ne(f.trim()),D(!1))},className:"relative",children:a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx(i,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"}),a.jsx("input",{ref:ae,type:"text",value:f,onChange:e=>{const t=e.target.value;if(j(t),D(t.length>=2),t.length>=2){const e=setTimeout(()=>{ne(t)},300);return()=>clearTimeout(e)}},onFocus:()=>D(f.length>=2),placeholder:"Search products, ingredients, or categories...",className:"w-full pl-12 pr-4 py-4 rounded-xl border border-slate-300 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 text-lg"}),B&&a.jsxs("div",{ref:le,className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl border border-slate-200 z-50 max-h-96 overflow-y-auto",children:[G.length>0?a.jsx("div",{className:"p-2",children:G.map((e,t)=>a.jsxs("div",{onClick:()=>xe(e.suggestion),className:"flex items-center gap-3 p-3 rounded-lg hover:bg-slate-50 cursor-pointer transition-colors",children:[a.jsx(i,{className:"w-4 h-4 text-blue-500"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium text-slate-800",children:e.suggestion}),a.jsxs("div",{className:"text-sm text-slate-500",children:[e.count," products"]})]})]},t))}):null,V.length>0&&a.jsxs("div",{className:"border-t border-slate-200 p-2",children:[a.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-slate-500 uppercase tracking-wide",children:[a.jsx(n,{className:"w-3 h-3 inline mr-1"}),"Recent Searches"]}),V.map((e,t)=>a.jsxs("div",{onClick:()=>xe(e),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer transition-colors",children:[a.jsx(n,{className:"w-3 h-3 text-slate-400"}),a.jsx("span",{className:"text-sm text-slate-600",children:e})]},t))]}),a.jsxs("div",{className:"border-t border-slate-200 p-2",children:[a.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-slate-500 uppercase tracking-wide",children:[a.jsx(o,{className:"w-3 h-3 inline mr-1"}),"Popular Searches"]}),a.jsx("div",{className:"flex flex-wrap gap-2 p-3",children:K.map((e,t)=>a.jsx("button",{onClick:()=>xe(e),className:"px-3 py-1 text-xs bg-slate-100 text-slate-600 rounded-full hover:bg-slate-200 transition-colors",children:e},t))})]})]})]}),a.jsxs("button",{type:"button",onClick:()=>z(!U),className:"px-6 py-4 rounded-xl bg-slate-200 hover:bg-slate-300 transition-colors flex items-center gap-2",children:[a.jsx(c,{className:"w-5 h-5"}),"Filters"]})]})})}),U&&k&&a.jsxs("div",{className:"mb-8 p-6 bg-white rounded-xl shadow-lg border border-slate-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"Advanced Filters"}),a.jsx("button",{onClick:de,className:"text-blue-600 hover:text-blue-700 font-medium",children:"Clear All"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Category"}),a.jsxs("select",{value:F,onChange:e=>{I(e.target.value),ce()},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200",children:[a.jsx("option",{value:"",children:"All Categories"}),k.categories.map(e=>a.jsxs("option",{value:e.name,children:[e.name," (",e.count,")"]},e.name))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Price Range (â‚¹)"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"number",placeholder:"Min",value:P.min,onChange:e=>{A(t=>({...t,min:e.target.value})),ce()},className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200"}),a.jsx("input",{type:"number",placeholder:"Max",value:P.max,onChange:e=>{A(t=>({...t,max:e.target.value})),ce()},className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Sort By"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("select",{value:O,onChange:e=>{W(e.target.value),ce()},className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200",children:[a.jsx("option",{value:"relevance",children:"Relevance"}),a.jsx("option",{value:"price",children:"Price"}),a.jsx("option",{value:"title",children:"Name"}),a.jsx("option",{value:"category",children:"Category"}),a.jsx("option",{value:"created_at",children:"Newest"})]}),a.jsx("button",{onClick:()=>{q("asc"===J?"desc":"asc"),ce()},className:"px-3 py-2 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"asc"===J?a.jsx(d,{className:"w-4 h-4"}):a.jsx(m,{className:"w-4 h-4"})})]})]})]})]}),a.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[a.jsx("div",{className:"text-slate-600",children:f?a.jsxs("span",{children:["Found ",a.jsx("strong",{children:se})," result",1!==se?"s":"",' for "',a.jsx("strong",{children:f}),'"']}):a.jsxs("span",{children:["Showing ",a.jsx("strong",{children:se})," product",1!==se?"s":""]})}),a.jsxs("div",{className:"text-sm text-slate-500",children:["Page ",Y," of ",ee]})]}),N&&a.jsx("div",{className:"flex items-center justify-center py-20"}),_&&a.jsxs("div",{className:"text-center py-20",children:[a.jsx("div",{className:"text-red-500 text-xl mb-4",children:"âš ï¸"}),a.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Search Error"}),a.jsx("p",{className:"text-slate-600",children:_})]}),!N&&!_&&v.length>0&&a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:v.map(e=>{var t,s;return a.jsxs("div",{className:"group bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden",children:[a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:pe(e)||"",alt:e.title,className:"w-full h-64 object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy",onError:e=>{e.currentTarget.style.display="none"}}),a.jsx("button",{onClick:()=>(e=>{const t=parseInt(e.id);b(t)?h(t):g(t)})(e),className:"absolute top-3 right-3 p-2 rounded-full transition-colors "+(b(parseInt(e.id))?"bg-red-500 text-white":"bg-white/80 text-slate-600 hover:bg-red-500 hover:text-white"),children:a.jsx(u,{className:"w-4 h-4 "+(b(parseInt(e.id))?"fill-current":"")})}),e.category&&a.jsx("div",{className:"absolute top-3 left-3 px-2 py-1 text-white text-xs rounded-full",style:{backgroundColor:"rgb(75,151,201)"},children:e.category})]}),a.jsxs("div",{className:"p-6",children:[a.jsx("h3",{className:"font-semibold text-slate-800 mb-2 line-clamp-2 group-hover:text-blue-600 transition-colors",children:e.title}),a.jsx("p",{className:"text-slate-600 text-sm mb-4 line-clamp-3",children:e.description}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex flex-col",children:(null==(t=e.details)?void 0:t.mrp)&&(null==(s=e.details)?void 0:s.websitePrice)?a.jsxs("div",{children:[a.jsxs("div",{className:"text-gray-500 line-through text-sm",children:["â‚¹",e.details.mrp]}),a.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["â‚¹",e.details.websitePrice]}),a.jsxs("div",{className:"text-xs text-green-500",children:[Math.round((parseFloat(e.details.mrp)-parseFloat(e.details.websitePrice))/parseFloat(e.details.mrp)*100),"% OFF"]})]}):a.jsxs("div",{className:"text-2xl font-bold text-gradient-primary",children:["â‚¹",e.price]})}),a.jsxs("button",{onClick:()=>(e=>{const t=pe(e),s=[t,...Array.isArray(e.pdp_images)?e.pdp_images.map(e=>ue(e.url)):[],e.pdp_image_1&&ue(e.pdp_image_1),e.pdp_image_2&&ue(e.pdp_image_2),e.pdp_image_3&&ue(e.pdp_image_3),e.pdp_image_4&&ue(e.pdp_image_4),e.pdp_image_5&&ue(e.pdp_image_5),e.pdp_image_6&&ue(e.pdp_image_6)].filter((e,t,s)=>!!e&&s.indexOf(e)===t);x({id:parseInt(e.id)||void 0,slug:e.slug||e.title.toLowerCase().replace(/\s+/g,"-"),title:e.title,price:e.price,listImage:t,pdpImages:s,category:e.category,description:e.description},1)})(e),className:"flex items-center gap-2 px-4 py-2 text-white rounded-lg transition-colors",style:{backgroundColor:"rgb(75,151,201)",color:"#FFFFFF"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgb(60,120,160)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgb(75,151,201)"},children:[a.jsx(p,{className:"w-4 h-4"}),"Add to Cart"]})]})]})]},e.id)})}),!N&&!_&&f&&0===v.length&&a.jsxs("div",{className:"text-center py-20",children:[a.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”"}),a.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"No products found"}),a.jsxs("p",{className:"text-slate-600 mb-6",children:['No products match "',f,'". Try different keywords or adjust your filters.']}),a.jsx("button",{onClick:de,className:"px-6 py-3 text-white rounded-lg transition-colors",style:{backgroundColor:"rgb(75,151,201)"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="rgb(60,120,160)",onMouseLeave:e=>e.currentTarget.style.backgroundColor="rgb(75,151,201)",children:"Clear Filters"})]}),!N&&!_&&ee>1&&a.jsxs("div",{className:"mt-12 flex items-center justify-center gap-2",children:[a.jsx("button",{onClick:()=>me(Y-1),disabled:1===Y,className:"px-4 py-2 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),Array.from({length:Math.min(5,ee)},(e,t)=>{const s=t+1;return a.jsx("button",{onClick:()=>me(s),className:"px-4 py-2 border rounded-lg transition-colors "+(Y===s?"text-white border-blue-600":"border-slate-300 hover:bg-slate-50"),style:Y===s?{backgroundColor:"rgb(75,151,201)"}:void 0,children:s},s)}),a.jsx("button",{onClick:()=>me(Y+1),disabled:Y===ee,className:"px-4 py-2 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})})}export{x as default};
